<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>EnvironmentInformation.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">besu</a> &gt; <a href="index.source.html" class="el_package">org.hyperledger.besu.ethereum.referencetests</a> &gt; <span class="el_source">EnvironmentInformation.java</span></div><h1>EnvironmentInformation.java</h1><pre class="source lang-java linenums">/*
 * Copyright ConsenSys AG.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except in compliance with
 * the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on
 * an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 *
 */
package org.hyperledger.besu.ethereum.referencetests;

import org.hyperledger.besu.datatypes.Address;
import org.hyperledger.besu.datatypes.Wei;
import org.hyperledger.besu.ethereum.core.BlockHeader;

import com.fasterxml.jackson.annotation.JsonCreator;
import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import com.fasterxml.jackson.annotation.JsonProperty;
import org.apache.tuweni.bytes.Bytes;

/**
 * A wrapper for the environmental information that corresponds to a particular message call or
 * contract creation.
 *
 * &lt;p&gt;Note: this is meant to map to I in Section 9.3 &quot;Execution Environment&quot; in the Yellow Paper
 * Revision 59dccd. Its implementation will be completed as the VM implementation itself becomes
 * more complete.
 */
@JsonIgnoreProperties(ignoreUnknown = true)
public class EnvironmentInformation {

  private final Address accountAddress;

  private final Wei accountBalance;

  private BlockHeader blockHeader;

  private final Address callerAddress;

  private final Bytes code;

  private final Bytes data;

  private final int depth;

  private final Wei gasPrice;

  private final Address originAddress;

  private final Wei value;

  private final long gas;

  /**
   * Public constructor.
   *
   * @param account The address of the currently executing account.
   * @param balance Balance of the account being executed
   * @param caller The caller address.
   * @param code The code to be executed.
   * @param data The data of the current environment that pertains to the input data passed with the
   * @param gas The amount of gas allocated to the transaction
   * @param gasPrice The gas price specified by the originating transaction.
   * @param origin The sender address of the original transaction. message call instruction or
   *     transaction.
   * @param value The deposited value by the instruction/transaction responsible for this execution.
   */
  @SuppressWarnings(&quot;unused&quot;) // jackson reflected constructor
  @JsonCreator
  public EnvironmentInformation(
      @JsonProperty(&quot;address&quot;) final String account,
      @JsonProperty(&quot;balance&quot;) final String balance,
      @JsonProperty(&quot;caller&quot;) final String caller,
      @JsonProperty(&quot;code&quot;) final Bytes code,
      @JsonProperty(&quot;data&quot;) final String data,
      @JsonProperty(&quot;gas&quot;) final String gas,
      @JsonProperty(&quot;gasPrice&quot;) final String gasPrice,
      @JsonProperty(&quot;origin&quot;) final String origin,
      @JsonProperty(&quot;value&quot;) final String value) {
<span class="nc" id="L86">    this(</span>
        code,
        0,
<span class="nc bnc" id="L89" title="All 2 branches missed.">        account == null ? null : Address.fromHexString(account),</span>
<span class="nc bnc" id="L90" title="All 2 branches missed.">        balance == null ? Wei.ZERO : Wei.fromHexString(balance),</span>
<span class="nc bnc" id="L91" title="All 2 branches missed.">        caller == null ? null : Address.fromHexString(caller),</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">        origin == null ? null : Address.fromHexString(origin),</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">        data == null ? null : Bytes.fromHexString(data),</span>
<span class="nc bnc" id="L94" title="All 2 branches missed.">        value == null ? null : Wei.fromHexString(value),</span>
<span class="nc bnc" id="L95" title="All 2 branches missed.">        gasPrice == null ? null : Wei.fromHexString(gasPrice),</span>
<span class="nc bnc" id="L96" title="All 2 branches missed.">        gas == null ? 0 : Long.decode(gas));</span>
<span class="nc" id="L97">  }</span>

  private EnvironmentInformation(
      final Bytes code,
      final int depth,
      final Address accountAddress,
      final Wei accountBalance,
      final Address callerAddress,
      final Address originAddress,
      final Bytes data,
      final Wei value,
      final Wei gasPrice,
<span class="nc" id="L109">      final long gas) {</span>
<span class="nc" id="L110">    this.code = code;</span>
<span class="nc" id="L111">    this.depth = depth;</span>
<span class="nc" id="L112">    this.accountAddress = accountAddress;</span>
<span class="nc" id="L113">    this.accountBalance = accountBalance;</span>
<span class="nc" id="L114">    this.callerAddress = callerAddress;</span>
<span class="nc" id="L115">    this.originAddress = originAddress;</span>
<span class="nc" id="L116">    this.data = data;</span>
<span class="nc" id="L117">    this.value = value;</span>
<span class="nc" id="L118">    this.gasPrice = gasPrice;</span>
<span class="nc" id="L119">    this.gas = gas;</span>
<span class="nc" id="L120">  }</span>

  /**
   * Assigns the block header.
   *
   * @param blockHeader A {@link BlockHeader}.
   */
  public void setBlockHeader(final BlockHeader blockHeader) {
<span class="nc" id="L128">    this.blockHeader = blockHeader;</span>
<span class="nc" id="L129">  }</span>

  /**
   * Returns the block header.
   *
   * @return the block header
   */
  public BlockHeader getBlockHeader() {
<span class="nc" id="L137">    return blockHeader;</span>
  }

  /**
   * Returns the address of the currently executing account.
   *
   * @return the address of the currently executing account.
   */
  public Address getAccountAddress() {
<span class="nc" id="L146">    return accountAddress;</span>
  }

  /**
   * Returns the balance of the currently executing account
   *
   * @return the balance of the currently executing account
   */
  public Wei getAccountBalance() {
<span class="nc" id="L155">    return accountBalance;</span>
  }

  /**
   * Returns address of the caller.
   *
   * @return address of the caller.
   */
  public Address getCallerAddress() {
<span class="nc" id="L164">    return callerAddress;</span>
  }

  /**
   * Returns the call value.
   *
   * @return the call value.
   */
  public Wei getValue() {
<span class="nc" id="L173">    return value;</span>
  }

  /**
   * Returns code to be executed.
   *
   * @return code to be executed.
   */
  public Bytes getCode() {
<span class="nc" id="L182">    return code;</span>
  }

  /**
   * Returns the input data to be used.
   *
   * @return the input data to be used.
   */
  public Bytes getData() {
<span class="nc" id="L191">    return data;</span>
  }

  /**
   * Returns the call depth of the current message-call/contract creation.
   *
   * @return the call depth of the current message-call/contract creation.
   */
  public int getDepth() {
<span class="nc" id="L200">    return depth;</span>
  }

  /**
   * Returns the gas price specified by the originating transaction.
   *
   * @return the gas price specified by the originating transaction.
   */
  public Wei getGasPrice() {
<span class="nc" id="L209">    return gasPrice;</span>
  }

  /**
   * Returns the amount of gas available.
   *
   * @return the amount of gas available.
   */
  public long getGas() {
<span class="nc" id="L218">    return gas;</span>
  }

  /**
   * Returns the sender address of the original transaction.
   *
   * @return the sender address of the original transaction.
   */
  public Address getOriginAddress() {
<span class="nc" id="L227">    return originAddress;</span>
  }

  @Override
  public String toString() {
<span class="nc" id="L232">    final StringBuilder builder = new StringBuilder();</span>
<span class="nc" id="L233">    builder</span>
<span class="nc" id="L234">        .append(&quot;Executing &quot;)</span>
<span class="nc" id="L235">        .append(code.toString())</span>
<span class="nc" id="L236">        .append(&quot;\nCode: &quot;)</span>
<span class="nc" id="L237">        .append(code)</span>
<span class="nc" id="L238">        .append(&quot;\nData: &quot;)</span>
<span class="nc" id="L239">        .append(data)</span>
<span class="nc" id="L240">        .append(&quot;\nAccount: &quot;)</span>
<span class="nc" id="L241">        .append(accountAddress)</span>
<span class="nc" id="L242">        .append(&quot;\nBlock header: \n  &quot;)</span>
<span class="nc" id="L243">        .append(blockHeader.toString().replace(&quot;\n&quot;, &quot;\n  &quot;))</span>
<span class="nc" id="L244">        .append(&quot;\nCaller: &quot;)</span>
<span class="nc" id="L245">        .append(callerAddress);</span>

<span class="nc" id="L247">    return builder.toString();</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>