<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PrivateTransactionReceiptResult.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">besu</a> &gt; <a href="index.source.html" class="el_package">org.hyperledger.besu.ethereum.api.jsonrpc.internal.results.privacy</a> &gt; <span class="el_source">PrivateTransactionReceiptResult.java</span></div><h1>PrivateTransactionReceiptResult.java</h1><pre class="source lang-java linenums">/*
 * Copyright ConsenSys AG.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except in compliance with
 * the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on
 * an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */
package org.hyperledger.besu.ethereum.api.jsonrpc.internal.results.privacy;

import org.hyperledger.besu.datatypes.Hash;
import org.hyperledger.besu.ethereum.api.jsonrpc.internal.results.Quantity;
import org.hyperledger.besu.ethereum.api.jsonrpc.internal.results.TransactionReceiptLogResult;
import org.hyperledger.besu.ethereum.privacy.PrivacyGroupUtil;
import org.hyperledger.besu.evm.log.Log;
import org.hyperledger.besu.evm.log.LogsBloomFilter;

import java.util.ArrayList;
import java.util.List;
import java.util.stream.Collectors;

import com.fasterxml.jackson.annotation.JsonGetter;
import com.fasterxml.jackson.annotation.JsonInclude;
import com.fasterxml.jackson.annotation.JsonPropertyOrder;
import org.apache.tuweni.bytes.Bytes;

@JsonPropertyOrder({
  &quot;contractAddress&quot;,
  &quot;from&quot;,
  &quot;to&quot;,
  &quot;output&quot;,
  &quot;commitmentHash&quot;,
  &quot;transactionHash&quot;,
  &quot;privateFrom&quot;,
  &quot;privateFor&quot;,
  &quot;privacyGroupId&quot;,
  &quot;status&quot;,
  &quot;revertReason&quot;,
  &quot;logs&quot;,
  &quot;logsBloom&quot;,
  &quot;blockHash&quot;,
  &quot;blockNumber&quot;,
  &quot;transactionIndex&quot;
})
@JsonInclude(JsonInclude.Include.NON_NULL)
public class PrivateTransactionReceiptResult {

  private final String blockHash;
  private final String blockNumber;
  private final String contractAddress;
  private final String from;
  private final List&lt;TransactionReceiptLogResult&gt; logs;
  private final String to;
  private final String transactionIndex;
  private final String revertReason;
  private final String output;
  private final String commitmentHash;
  private final String status;
  private final String privateFrom;
  private final List&lt;String&gt; privateFor;
  private final String privacyGroupId;
  private final String logsBloom;

  public PrivateTransactionReceiptResult(
      final String contractAddress,
      final String from,
      final String to,
      final List&lt;Log&gt; logs,
      final Bytes output,
      final Hash blockHash,
      final long blockNumber,
      final int txIndex,
      final Hash commitmentHash,
      final Bytes privateFrom,
      final List&lt;Bytes&gt; privateFor,
      final Bytes privacyGroupId,
      final Bytes revertReason,
<span class="fc" id="L84">      final String status) {</span>
<span class="fc" id="L85">    this.contractAddress = contractAddress;</span>
<span class="fc" id="L86">    this.from = from;</span>
<span class="fc" id="L87">    this.to = to;</span>
<span class="fc" id="L88">    this.output = output.toString();</span>
<span class="fc" id="L89">    this.commitmentHash = commitmentHash.toString();</span>
<span class="pc bpc" id="L90" title="1 of 2 branches missed.">    this.privateFrom = privateFrom != null ? privateFrom.toBase64String() : null;</span>
<span class="fc" id="L91">    this.privateFor =</span>
<span class="fc bfc" id="L92" title="All 2 branches covered.">        privateFor != null</span>
<span class="fc" id="L93">            ? privateFor.stream().map(Bytes::toBase64String).collect(Collectors.toList())</span>
<span class="fc" id="L94">            : null;</span>
<span class="fc" id="L95">    this.privacyGroupId =</span>
<span class="fc bfc" id="L96" title="All 2 branches covered.">        privacyGroupId != null</span>
<span class="fc" id="L97">            ? privacyGroupId.toBase64String()</span>
<span class="fc" id="L98">            : PrivacyGroupUtil.calculateEeaPrivacyGroupId(privateFrom, privateFor).toBase64String();</span>
<span class="fc bfc" id="L99" title="All 2 branches covered.">    this.revertReason = revertReason != null ? revertReason.toString() : null;</span>
<span class="fc" id="L100">    this.status = status;</span>
<span class="fc" id="L101">    this.logs = logReceipts(logs, blockNumber, commitmentHash, blockHash, txIndex);</span>
<span class="fc" id="L102">    this.logsBloom = LogsBloomFilter.builder().insertLogs(logs).build().toHexString();</span>
<span class="fc" id="L103">    this.blockHash = blockHash.toHexString();</span>
<span class="fc" id="L104">    this.blockNumber = Quantity.create(blockNumber);</span>
<span class="fc" id="L105">    this.transactionIndex = Quantity.create(txIndex);</span>
<span class="fc" id="L106">  }</span>

  @JsonGetter(value = &quot;contractAddress&quot;)
  public String getContractAddress() {
<span class="fc" id="L110">    return contractAddress;</span>
  }

  @JsonGetter(value = &quot;from&quot;)
  public String getFrom() {
<span class="fc" id="L115">    return from;</span>
  }

  @JsonGetter(value = &quot;to&quot;)
  public String getTo() {
<span class="fc" id="L120">    return to;</span>
  }

  @JsonGetter(value = &quot;output&quot;)
  public String getOutput() {
<span class="fc" id="L125">    return output;</span>
  }

  @JsonGetter(value = &quot;logs&quot;)
  public List&lt;TransactionReceiptLogResult&gt; getLogs() {
<span class="fc" id="L130">    return logs;</span>
  }

  @JsonGetter(value = &quot;logsBloom&quot;)
  public String getLogsBloom() {
<span class="fc" id="L135">    return logsBloom;</span>
  }

  @JsonGetter(&quot;commitmentHash&quot;)
  public String getCommitmentHash() {
<span class="fc" id="L140">    return commitmentHash;</span>
  }

  @JsonGetter(&quot;privateFrom&quot;)
  public String getPrivateFrom() {
<span class="fc" id="L145">    return privateFrom;</span>
  }

  @JsonGetter(&quot;privateFor&quot;)
  public List&lt;String&gt; getPrivateFor() {
<span class="fc" id="L150">    return privateFor;</span>
  }

  @JsonGetter(&quot;privacyGroupId&quot;)
  public String getPrivacyGroupId() {
<span class="fc" id="L155">    return privacyGroupId;</span>
  }

  @JsonGetter(&quot;revertReason&quot;)
  public String getRevertReason() {
<span class="fc" id="L160">    return revertReason;</span>
  }

  @JsonGetter(&quot;status&quot;)
  public String getStatus() {
<span class="fc" id="L165">    return status;</span>
  }

  @JsonGetter(value = &quot;transactionIndex&quot;)
  public String getTransactionIndex() {
<span class="fc" id="L170">    return transactionIndex;</span>
  }

  @JsonGetter(value = &quot;blockHash&quot;)
  public String getBlockHash() {
<span class="fc" id="L175">    return blockHash;</span>
  }

  @JsonGetter(value = &quot;blockNumber&quot;)
  public String getBlockNumber() {
<span class="fc" id="L180">    return blockNumber;</span>
  }

  private List&lt;TransactionReceiptLogResult&gt; logReceipts(
      final List&lt;Log&gt; logs,
      final long blockNumber,
      final Hash transactionHash,
      final Hash blockHash,
      final int transactionIndex) {
<span class="fc" id="L189">    final List&lt;TransactionReceiptLogResult&gt; logResults = new ArrayList&lt;&gt;(logs.size());</span>

<span class="pc bpc" id="L191" title="1 of 2 branches missed.">    for (int i = 0; i &lt; logs.size(); i++) {</span>
<span class="nc" id="L192">      final Log log = logs.get(i);</span>
<span class="nc" id="L193">      logResults.add(</span>
          new TransactionReceiptLogResult(
              log, blockNumber, transactionHash, blockHash, transactionIndex, i));
    }

<span class="fc" id="L198">    return logResults;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>