<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JsonGenesisConfigOptions.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">besu</a> &gt; <a href="index.source.html" class="el_package">org.hyperledger.besu.config</a> &gt; <span class="el_source">JsonGenesisConfigOptions.java</span></div><h1>JsonGenesisConfigOptions.java</h1><pre class="source lang-java linenums">/*
 * Copyright ConsenSys AG.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except in compliance with
 * the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on
 * an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */
package org.hyperledger.besu.config;

import static java.util.Collections.emptyMap;
import static java.util.Objects.isNull;

import org.hyperledger.besu.datatypes.Address;
import org.hyperledger.besu.datatypes.Hash;
import org.hyperledger.besu.datatypes.Wei;

import java.math.BigInteger;
import java.util.List;
import java.util.Map;
import java.util.Optional;
import java.util.OptionalInt;
import java.util.OptionalLong;
import java.util.TreeMap;
import java.util.stream.Stream;

import com.fasterxml.jackson.databind.node.ObjectNode;
import com.google.common.collect.ImmutableMap;
import org.apache.tuweni.units.bigints.UInt256;

/** The Json genesis config options. */
public class JsonGenesisConfigOptions implements GenesisConfigOptions {

  private static final String ETHASH_CONFIG_KEY = &quot;ethash&quot;;
  private static final String IBFT_LEGACY_CONFIG_KEY = &quot;ibft&quot;;
  private static final String IBFT2_CONFIG_KEY = &quot;ibft2&quot;;
  private static final String QBFT_CONFIG_KEY = &quot;qbft&quot;;
  private static final String CLIQUE_CONFIG_KEY = &quot;clique&quot;;
  private static final String EC_CURVE_CONFIG_KEY = &quot;eccurve&quot;;
  private static final String TRANSITIONS_CONFIG_KEY = &quot;transitions&quot;;
  private static final String DISCOVERY_CONFIG_KEY = &quot;discovery&quot;;
  private static final String CHECKPOINT_CONFIG_KEY = &quot;checkpoint&quot;;
  private static final String ZERO_BASE_FEE_KEY = &quot;zerobasefee&quot;;
  private static final String FIXED_BASE_FEE_KEY = &quot;fixedbasefee&quot;;
  private static final String DEPOSIT_CONTRACT_ADDRESS_KEY = &quot;depositcontractaddress&quot;;

  private final ObjectNode configRoot;
<span class="fc" id="L54">  private final Map&lt;String, String&gt; configOverrides = new TreeMap&lt;&gt;(String.CASE_INSENSITIVE_ORDER);</span>
  private final TransitionsConfigOptions transitions;

  /**
   * From json object json genesis config options.
   *
   * @param configRoot the config root
   * @return the json genesis config options
   */
  public static JsonGenesisConfigOptions fromJsonObject(final ObjectNode configRoot) {
<span class="fc" id="L64">    return fromJsonObjectWithOverrides(configRoot, emptyMap());</span>
  }

  /**
   * From json object with overrides json genesis config options.
   *
   * @param configRoot the config root
   * @param configOverrides the config overrides
   * @return the json genesis config options
   */
  static JsonGenesisConfigOptions fromJsonObjectWithOverrides(
      final ObjectNode configRoot, final Map&lt;String, String&gt; configOverrides) {
    final TransitionsConfigOptions transitionsConfigOptions;
<span class="fc" id="L77">    transitionsConfigOptions = loadTransitionsFrom(configRoot);</span>
<span class="fc" id="L78">    return new JsonGenesisConfigOptions(configRoot, configOverrides, transitionsConfigOptions);</span>
  }

  private static TransitionsConfigOptions loadTransitionsFrom(final ObjectNode parentNode) {
<span class="fc" id="L82">    final Optional&lt;ObjectNode&gt; transitionsNode =</span>
<span class="fc" id="L83">        JsonUtil.getObjectNode(parentNode, TRANSITIONS_CONFIG_KEY);</span>
<span class="fc bfc" id="L84" title="All 2 branches covered.">    if (transitionsNode.isEmpty()) {</span>
<span class="fc" id="L85">      return new TransitionsConfigOptions(JsonUtil.createEmptyObjectNode());</span>
    }

<span class="fc" id="L88">    return new TransitionsConfigOptions(transitionsNode.get());</span>
  }

  /**
   * Instantiates a new Json genesis config options.
   *
   * @param maybeConfig the optional config
   * @param configOverrides the config overrides map
   * @param transitionsConfig the transitions configuration
   */
  JsonGenesisConfigOptions(
      final ObjectNode maybeConfig,
      final Map&lt;String, String&gt; configOverrides,
<span class="fc" id="L101">      final TransitionsConfigOptions transitionsConfig) {</span>
<span class="pc bpc" id="L102" title="1 of 2 branches missed.">    this.configRoot = isNull(maybeConfig) ? JsonUtil.createEmptyObjectNode() : maybeConfig;</span>
<span class="fc bfc" id="L103" title="All 2 branches covered.">    if (configOverrides != null) {</span>
<span class="fc" id="L104">      this.configOverrides.putAll(configOverrides);</span>
    }
<span class="fc" id="L106">    this.transitions = transitionsConfig;</span>
<span class="fc" id="L107">  }</span>

  @Override
  public String getConsensusEngine() {
<span class="fc bfc" id="L111" title="All 2 branches covered.">    if (isEthHash()) {</span>
<span class="fc" id="L112">      return ETHASH_CONFIG_KEY;</span>
<span class="fc bfc" id="L113" title="All 2 branches covered.">    } else if (isIbft2()) {</span>
<span class="fc" id="L114">      return IBFT2_CONFIG_KEY;</span>
<span class="fc bfc" id="L115" title="All 2 branches covered.">    } else if (isQbft()) {</span>
<span class="fc" id="L116">      return QBFT_CONFIG_KEY;</span>
<span class="pc bpc" id="L117" title="1 of 2 branches missed.">    } else if (isClique()) {</span>
<span class="fc" id="L118">      return CLIQUE_CONFIG_KEY;</span>
    } else {
<span class="nc" id="L120">      return &quot;unknown&quot;;</span>
    }
  }

  @Override
  public boolean isEthHash() {
<span class="fc" id="L126">    return configRoot.has(ETHASH_CONFIG_KEY);</span>
  }

  @Override
  public boolean isIbftLegacy() {
<span class="fc" id="L131">    return configRoot.has(IBFT_LEGACY_CONFIG_KEY);</span>
  }

  @Override
  public boolean isClique() {
<span class="fc" id="L136">    return configRoot.has(CLIQUE_CONFIG_KEY);</span>
  }

  @Override
  public boolean isIbft2() {
<span class="fc" id="L141">    return configRoot.has(IBFT2_CONFIG_KEY);</span>
  }

  @Override
  public boolean isQbft() {
<span class="fc" id="L146">    return configRoot.has(QBFT_CONFIG_KEY);</span>
  }

  @Override
  public boolean isPoa() {
<span class="pc bpc" id="L151" title="1 of 8 branches missed.">    return isQbft() || isClique() || isIbft2() || isIbftLegacy();</span>
  }

  @Override
  public BftConfigOptions getBftConfigOptions() {
<span class="fc bfc" id="L156" title="All 2 branches covered.">    final String fieldKey = isIbft2() ? IBFT2_CONFIG_KEY : QBFT_CONFIG_KEY;</span>
<span class="fc" id="L157">    return JsonUtil.getObjectNode(configRoot, fieldKey)</span>
<span class="fc" id="L158">        .map(JsonBftConfigOptions::new)</span>
<span class="fc" id="L159">        .orElse(JsonBftConfigOptions.DEFAULT);</span>
  }

  @Override
  public QbftConfigOptions getQbftConfigOptions() {
<span class="fc" id="L164">    return JsonUtil.getObjectNode(configRoot, QBFT_CONFIG_KEY)</span>
<span class="fc" id="L165">        .map(JsonQbftConfigOptions::new)</span>
<span class="fc" id="L166">        .orElse(JsonQbftConfigOptions.DEFAULT);</span>
  }

  @Override
  public DiscoveryOptions getDiscoveryOptions() {
<span class="fc" id="L171">    return JsonUtil.getObjectNode(configRoot, DISCOVERY_CONFIG_KEY)</span>
<span class="fc" id="L172">        .map(DiscoveryOptions::new)</span>
<span class="fc" id="L173">        .orElse(DiscoveryOptions.DEFAULT);</span>
  }

  @Override
  public CheckpointConfigOptions getCheckpointOptions() {
<span class="fc" id="L178">    return JsonUtil.getObjectNode(configRoot, CHECKPOINT_CONFIG_KEY)</span>
<span class="fc" id="L179">        .map(CheckpointConfigOptions::new)</span>
<span class="fc" id="L180">        .orElse(CheckpointConfigOptions.DEFAULT);</span>
  }

  @Override
  public JsonCliqueConfigOptions getCliqueConfigOptions() {
<span class="fc" id="L185">    return JsonUtil.getObjectNode(configRoot, CLIQUE_CONFIG_KEY)</span>
<span class="fc" id="L186">        .map(JsonCliqueConfigOptions::new)</span>
<span class="fc" id="L187">        .orElse(JsonCliqueConfigOptions.DEFAULT);</span>
  }

  @Override
  public EthashConfigOptions getEthashConfigOptions() {
<span class="fc" id="L192">    return JsonUtil.getObjectNode(configRoot, ETHASH_CONFIG_KEY)</span>
<span class="fc" id="L193">        .map(EthashConfigOptions::new)</span>
<span class="fc" id="L194">        .orElse(EthashConfigOptions.DEFAULT);</span>
  }

  @Override
  public TransitionsConfigOptions getTransitions() {
<span class="fc" id="L199">    return transitions;</span>
  }

  @Override
  public OptionalLong getHomesteadBlockNumber() {
<span class="fc" id="L204">    return getOptionalLong(&quot;homesteadblock&quot;);</span>
  }

  @Override
  public OptionalLong getDaoForkBlock() {
<span class="fc" id="L209">    final OptionalLong block = getOptionalLong(&quot;daoforkblock&quot;);</span>
<span class="fc bfc" id="L210" title="All 4 branches covered.">    if (block.isPresent() &amp;&amp; block.getAsLong() &lt;= 0) {</span>
<span class="fc" id="L211">      return OptionalLong.empty();</span>
    }
<span class="fc" id="L213">    return block;</span>
  }

  @Override
  public OptionalLong getTangerineWhistleBlockNumber() {
<span class="fc" id="L218">    return getOptionalLong(&quot;eip150block&quot;);</span>
  }

  @Override
  public OptionalLong getSpuriousDragonBlockNumber() {
<span class="fc" id="L223">    return getOptionalLong(&quot;eip158block&quot;);</span>
  }

  @Override
  public OptionalLong getByzantiumBlockNumber() {
<span class="fc" id="L228">    return getOptionalLong(&quot;byzantiumblock&quot;);</span>
  }

  @Override
  public OptionalLong getConstantinopleBlockNumber() {
<span class="fc" id="L233">    return getOptionalLong(&quot;constantinopleblock&quot;);</span>
  }

  @Override
  public OptionalLong getPetersburgBlockNumber() {
<span class="fc" id="L238">    final OptionalLong petersburgBlock = getOptionalLong(&quot;petersburgblock&quot;);</span>
<span class="fc" id="L239">    final OptionalLong constantinopleFixBlock = getOptionalLong(&quot;constantinoplefixblock&quot;);</span>
<span class="fc bfc" id="L240" title="All 2 branches covered.">    if (constantinopleFixBlock.isPresent()) {</span>
<span class="fc bfc" id="L241" title="All 2 branches covered.">      if (petersburgBlock.isPresent()) {</span>
<span class="fc" id="L242">        throw new RuntimeException(</span>
            &quot;Genesis files cannot specify both petersburgBlock and constantinopleFixBlock.&quot;);
      }
<span class="fc" id="L245">      return constantinopleFixBlock;</span>
    }
<span class="fc" id="L247">    return petersburgBlock;</span>
  }

  @Override
  public OptionalLong getIstanbulBlockNumber() {
<span class="fc" id="L252">    return getOptionalLong(&quot;istanbulblock&quot;);</span>
  }

  @Override
  public OptionalLong getMuirGlacierBlockNumber() {
<span class="fc" id="L257">    return getOptionalLong(&quot;muirglacierblock&quot;);</span>
  }

  @Override
  public OptionalLong getBerlinBlockNumber() {
<span class="fc" id="L262">    return getOptionalLong(&quot;berlinblock&quot;);</span>
  }

  @Override
  public OptionalLong getLondonBlockNumber() {
<span class="fc" id="L267">    return getOptionalLong(&quot;londonblock&quot;);</span>
  }

  @Override
  public OptionalLong getArrowGlacierBlockNumber() {
<span class="fc" id="L272">    return getOptionalLong(&quot;arrowglacierblock&quot;);</span>
  }

  @Override
  public OptionalLong getGrayGlacierBlockNumber() {
<span class="fc" id="L277">    return getOptionalLong(&quot;grayglacierblock&quot;);</span>
  }

  @Override
  public OptionalLong getMergeNetSplitBlockNumber() {
<span class="fc" id="L282">    return getOptionalLong(&quot;mergenetsplitblock&quot;);</span>
  }

  @Override
  public OptionalLong getShanghaiTime() {
<span class="fc" id="L287">    return getOptionalLong(&quot;shanghaitime&quot;);</span>
  }

  @Override
  public OptionalLong getCancunTime() {
<span class="fc" id="L292">    return getOptionalLong(&quot;cancuntime&quot;);</span>
  }

  @Override
  public OptionalLong getPragueTime() {
<span class="fc" id="L297">    return getOptionalLong(&quot;praguetime&quot;);</span>
  }

  @Override
  public OptionalLong getFutureEipsTime() {
<span class="fc" id="L302">    return getOptionalLong(&quot;futureeipstime&quot;);</span>
  }

  @Override
  public OptionalLong getExperimentalEipsTime() {
<span class="fc" id="L307">    return getOptionalLong(&quot;experimentaleipstime&quot;);</span>
  }

  @Override
  public Optional&lt;Wei&gt; getBaseFeePerGas() {
<span class="fc" id="L312">    return Optional.ofNullable(configOverrides.get(&quot;baseFeePerGas&quot;)).map(Wei::fromHexString);</span>
  }

  @Override
  public Optional&lt;UInt256&gt; getTerminalTotalDifficulty() {
<span class="fc" id="L317">    return getOptionalBigInteger(&quot;terminaltotaldifficulty&quot;).map(UInt256::valueOf);</span>
  }

  @Override
  public OptionalLong getTerminalBlockNumber() {
<span class="fc" id="L322">    return getOptionalLong(&quot;terminalblocknumber&quot;);</span>
  }

  @Override
  public Optional&lt;Hash&gt; getTerminalBlockHash() {
<span class="fc" id="L327">    return getOptionalHash(&quot;terminalblockhash&quot;);</span>
  }

  @Override
  public OptionalLong getClassicForkBlock() {
<span class="fc" id="L332">    return getOptionalLong(&quot;classicforkblock&quot;);</span>
  }

  @Override
  public OptionalLong getEcip1015BlockNumber() {
<span class="fc" id="L337">    return getOptionalLong(&quot;ecip1015block&quot;);</span>
  }

  @Override
  public OptionalLong getDieHardBlockNumber() {
<span class="fc" id="L342">    return getOptionalLong(&quot;diehardblock&quot;);</span>
  }

  @Override
  public OptionalLong getGothamBlockNumber() {
<span class="fc" id="L347">    return getOptionalLong(&quot;gothamblock&quot;);</span>
  }

  @Override
  public OptionalLong getDefuseDifficultyBombBlockNumber() {
<span class="fc" id="L352">    return getOptionalLong(&quot;ecip1041block&quot;);</span>
  }

  @Override
  public OptionalLong getAtlantisBlockNumber() {
<span class="fc" id="L357">    return getOptionalLong(&quot;atlantisblock&quot;);</span>
  }

  @Override
  public OptionalLong getAghartaBlockNumber() {
<span class="fc" id="L362">    return getOptionalLong(&quot;aghartablock&quot;);</span>
  }

  @Override
  public OptionalLong getPhoenixBlockNumber() {
<span class="fc" id="L367">    return getOptionalLong(&quot;phoenixblock&quot;);</span>
  }

  @Override
  public OptionalLong getThanosBlockNumber() {
<span class="fc" id="L372">    return getOptionalLong(&quot;thanosblock&quot;);</span>
  }

  @Override
  public OptionalLong getMagnetoBlockNumber() {
<span class="fc" id="L377">    return getOptionalLong(&quot;magnetoblock&quot;);</span>
  }

  @Override
  public OptionalLong getMystiqueBlockNumber() {
<span class="fc" id="L382">    return getOptionalLong(&quot;mystiqueblock&quot;);</span>
  }

  @Override
  public OptionalLong getSpiralBlockNumber() {
<span class="fc" id="L387">    return getOptionalLong(&quot;spiralblock&quot;);</span>
  }

  @Override
  public Optional&lt;BigInteger&gt; getChainId() {
<span class="fc" id="L392">    return getOptionalBigInteger(&quot;chainid&quot;);</span>
  }

  @Override
  public OptionalInt getContractSizeLimit() {
<span class="fc" id="L397">    return getOptionalInt(&quot;contractsizelimit&quot;);</span>
  }

  @Override
  public OptionalInt getEvmStackSize() {
<span class="fc" id="L402">    return getOptionalInt(&quot;evmstacksize&quot;);</span>
  }

  @Override
  public OptionalLong getEcip1017EraRounds() {
<span class="fc" id="L407">    return getOptionalLong(&quot;ecip1017erarounds&quot;);</span>
  }

  @Override
  public PowAlgorithm getPowAlgorithm() {
<span class="fc bfc" id="L412" title="All 2 branches covered.">    return isEthHash() ? PowAlgorithm.ETHASH : PowAlgorithm.UNSUPPORTED;</span>
  }

  @Override
  public Optional&lt;String&gt; getEcCurve() {
<span class="fc" id="L417">    return JsonUtil.getString(configRoot, EC_CURVE_CONFIG_KEY);</span>
  }

  @Override
  public boolean isZeroBaseFee() {
<span class="fc" id="L422">    return getOptionalBoolean(ZERO_BASE_FEE_KEY).orElse(false);</span>
  }

  @Override
  public boolean isFixedBaseFee() {
<span class="fc" id="L427">    return getOptionalBoolean(FIXED_BASE_FEE_KEY).orElse(false);</span>
  }

  @Override
  public Optional&lt;Address&gt; getDepositContractAddress() {
<span class="fc" id="L432">    Optional&lt;String&gt; inputAddress = JsonUtil.getString(configRoot, DEPOSIT_CONTRACT_ADDRESS_KEY);</span>
<span class="fc" id="L433">    return inputAddress.map(Address::fromHexString);</span>
  }

  @Override
  public Map&lt;String, Object&gt; asMap() {
<span class="fc" id="L438">    final ImmutableMap.Builder&lt;String, Object&gt; builder = ImmutableMap.builder();</span>
<span class="pc" id="L439">    getChainId().ifPresent(chainId -&gt; builder.put(&quot;chainId&quot;, chainId));</span>

    // mainnet fork blocks
<span class="fc" id="L442">    getHomesteadBlockNumber().ifPresent(l -&gt; builder.put(&quot;homesteadBlock&quot;, l));</span>
<span class="fc" id="L443">    getDaoForkBlock().ifPresent(l -&gt; builder.put(&quot;daoForkBlock&quot;, l));</span>
<span class="fc" id="L444">    getTangerineWhistleBlockNumber().ifPresent(l -&gt; builder.put(&quot;eip150Block&quot;, l));</span>
<span class="fc" id="L445">    getSpuriousDragonBlockNumber().ifPresent(l -&gt; builder.put(&quot;eip158Block&quot;, l));</span>
<span class="fc" id="L446">    getByzantiumBlockNumber().ifPresent(l -&gt; builder.put(&quot;byzantiumBlock&quot;, l));</span>
<span class="fc" id="L447">    getConstantinopleBlockNumber().ifPresent(l -&gt; builder.put(&quot;constantinopleBlock&quot;, l));</span>
<span class="fc" id="L448">    getPetersburgBlockNumber().ifPresent(l -&gt; builder.put(&quot;petersburgBlock&quot;, l));</span>
<span class="fc" id="L449">    getIstanbulBlockNumber().ifPresent(l -&gt; builder.put(&quot;istanbulBlock&quot;, l));</span>
<span class="fc" id="L450">    getMuirGlacierBlockNumber().ifPresent(l -&gt; builder.put(&quot;muirGlacierBlock&quot;, l));</span>
<span class="fc" id="L451">    getBerlinBlockNumber().ifPresent(l -&gt; builder.put(&quot;berlinBlock&quot;, l));</span>
<span class="fc" id="L452">    getLondonBlockNumber().ifPresent(l -&gt; builder.put(&quot;londonBlock&quot;, l));</span>
<span class="fc" id="L453">    getArrowGlacierBlockNumber().ifPresent(l -&gt; builder.put(&quot;arrowGlacierBlock&quot;, l));</span>
<span class="fc" id="L454">    getGrayGlacierBlockNumber().ifPresent(l -&gt; builder.put(&quot;grayGlacierBlock&quot;, l));</span>
<span class="fc" id="L455">    getMergeNetSplitBlockNumber().ifPresent(l -&gt; builder.put(&quot;mergeNetSplitBlock&quot;, l));</span>
<span class="fc" id="L456">    getShanghaiTime().ifPresent(l -&gt; builder.put(&quot;shanghaiTime&quot;, l));</span>
<span class="fc" id="L457">    getCancunTime().ifPresent(l -&gt; builder.put(&quot;cancunTime&quot;, l));</span>
<span class="fc" id="L458">    getPragueTime().ifPresent(l -&gt; builder.put(&quot;pragueTime&quot;, l));</span>
<span class="pc" id="L459">    getTerminalBlockNumber().ifPresent(l -&gt; builder.put(&quot;terminalBlockNumber&quot;, l));</span>
<span class="pc" id="L460">    getTerminalBlockHash().ifPresent(h -&gt; builder.put(&quot;terminalBlockHash&quot;, h.toHexString()));</span>
<span class="fc" id="L461">    getFutureEipsTime().ifPresent(l -&gt; builder.put(&quot;futureEipsTime&quot;, l));</span>
<span class="fc" id="L462">    getExperimentalEipsTime().ifPresent(l -&gt; builder.put(&quot;experimentalEipsTime&quot;, l));</span>

    // classic fork blocks
<span class="pc" id="L465">    getClassicForkBlock().ifPresent(l -&gt; builder.put(&quot;classicForkBlock&quot;, l));</span>
<span class="fc" id="L466">    getEcip1015BlockNumber().ifPresent(l -&gt; builder.put(&quot;ecip1015Block&quot;, l));</span>
<span class="fc" id="L467">    getDieHardBlockNumber().ifPresent(l -&gt; builder.put(&quot;dieHardBlock&quot;, l));</span>
<span class="fc" id="L468">    getGothamBlockNumber().ifPresent(l -&gt; builder.put(&quot;gothamBlock&quot;, l));</span>
<span class="fc" id="L469">    getDefuseDifficultyBombBlockNumber().ifPresent(l -&gt; builder.put(&quot;ecip1041Block&quot;, l));</span>
<span class="fc" id="L470">    getAtlantisBlockNumber().ifPresent(l -&gt; builder.put(&quot;atlantisBlock&quot;, l));</span>
<span class="fc" id="L471">    getAghartaBlockNumber().ifPresent(l -&gt; builder.put(&quot;aghartaBlock&quot;, l));</span>
<span class="fc" id="L472">    getPhoenixBlockNumber().ifPresent(l -&gt; builder.put(&quot;phoenixBlock&quot;, l));</span>
<span class="fc" id="L473">    getThanosBlockNumber().ifPresent(l -&gt; builder.put(&quot;thanosBlock&quot;, l));</span>
<span class="fc" id="L474">    getMagnetoBlockNumber().ifPresent(l -&gt; builder.put(&quot;magnetoBlock&quot;, l));</span>
<span class="fc" id="L475">    getMystiqueBlockNumber().ifPresent(l -&gt; builder.put(&quot;mystiqueBlock&quot;, l));</span>
<span class="fc" id="L476">    getSpiralBlockNumber().ifPresent(l -&gt; builder.put(&quot;spiralBlock&quot;, l));</span>

<span class="pc" id="L478">    getContractSizeLimit().ifPresent(l -&gt; builder.put(&quot;contractSizeLimit&quot;, l));</span>
<span class="pc" id="L479">    getEvmStackSize().ifPresent(l -&gt; builder.put(&quot;evmstacksize&quot;, l));</span>
<span class="pc" id="L480">    getEcip1017EraRounds().ifPresent(l -&gt; builder.put(&quot;ecip1017EraRounds&quot;, l));</span>

<span class="fc" id="L482">    getDepositContractAddress().ifPresent(l -&gt; builder.put(&quot;depositContractAddress&quot;, l));</span>

<span class="pc bpc" id="L484" title="1 of 2 branches missed.">    if (isClique()) {</span>
<span class="nc" id="L485">      builder.put(&quot;clique&quot;, getCliqueConfigOptions().asMap());</span>
    }
<span class="pc bpc" id="L487" title="1 of 2 branches missed.">    if (isEthHash()) {</span>
<span class="nc" id="L488">      builder.put(&quot;ethash&quot;, getEthashConfigOptions().asMap());</span>
    }
<span class="pc bpc" id="L490" title="1 of 2 branches missed.">    if (isIbft2()) {</span>
<span class="nc" id="L491">      builder.put(&quot;ibft2&quot;, getBftConfigOptions().asMap());</span>
    }
<span class="pc bpc" id="L493" title="1 of 2 branches missed.">    if (isQbft()) {</span>
<span class="nc" id="L494">      builder.put(&quot;qbft&quot;, getQbftConfigOptions().asMap());</span>
    }

<span class="fc bfc" id="L497" title="All 2 branches covered.">    if (isZeroBaseFee()) {</span>
<span class="fc" id="L498">      builder.put(&quot;zeroBaseFee&quot;, true);</span>
    }

<span class="fc bfc" id="L501" title="All 2 branches covered.">    if (isFixedBaseFee()) {</span>
<span class="fc" id="L502">      builder.put(&quot;fixedBaseFee&quot;, true);</span>
    }

<span class="fc" id="L505">    return builder.build();</span>
  }

  private OptionalLong getOptionalLong(final String key) {
<span class="fc bfc" id="L509" title="All 2 branches covered.">    if (configOverrides.containsKey(key)) {</span>
<span class="fc" id="L510">      final String value = configOverrides.get(key);</span>
<span class="fc bfc" id="L511" title="All 4 branches covered.">      return value == null || value.isEmpty()</span>
<span class="fc" id="L512">          ? OptionalLong.empty()</span>
<span class="fc" id="L513">          : OptionalLong.of(Long.valueOf(configOverrides.get(key), 10));</span>
    } else {
<span class="fc" id="L515">      return JsonUtil.getLong(configRoot, key);</span>
    }
  }

  private OptionalInt getOptionalInt(final String key) {
<span class="fc bfc" id="L520" title="All 2 branches covered.">    if (configOverrides.containsKey(key)) {</span>
<span class="fc" id="L521">      final String value = configOverrides.get(key);</span>
<span class="fc bfc" id="L522" title="All 4 branches covered.">      return value == null || value.isEmpty()</span>
<span class="fc" id="L523">          ? OptionalInt.empty()</span>
<span class="fc" id="L524">          : OptionalInt.of(Integer.valueOf(configOverrides.get(key), 10));</span>
    } else {
<span class="fc" id="L526">      return JsonUtil.getInt(configRoot, key);</span>
    }
  }

  private Optional&lt;BigInteger&gt; getOptionalBigInteger(final String key) {
<span class="fc bfc" id="L531" title="All 2 branches covered.">    if (configOverrides.containsKey(key)) {</span>
<span class="fc" id="L532">      final String value = configOverrides.get(key);</span>
<span class="fc bfc" id="L533" title="All 4 branches covered.">      return value == null || value.isEmpty()</span>
<span class="fc" id="L534">          ? Optional.empty()</span>
<span class="fc" id="L535">          : Optional.of(new BigInteger(value));</span>
    } else {
<span class="fc" id="L537">      return JsonUtil.getValueAsString(configRoot, key).map(s -&gt; new BigInteger(s, 10));</span>
    }
  }

  private Optional&lt;Boolean&gt; getOptionalBoolean(final String key) {
<span class="pc bpc" id="L542" title="1 of 2 branches missed.">    if (configOverrides.containsKey(key)) {</span>
<span class="nc" id="L543">      final String value = configOverrides.get(key);</span>
<span class="nc bnc" id="L544" title="All 4 branches missed.">      return value == null || value.isEmpty()</span>
<span class="nc" id="L545">          ? Optional.empty()</span>
<span class="nc" id="L546">          : Optional.of(Boolean.valueOf(configOverrides.get(key)));</span>
    } else {
<span class="fc" id="L548">      return JsonUtil.getBoolean(configRoot, key);</span>
    }
  }

  private Optional&lt;Hash&gt; getOptionalHash(final String key) {
<span class="pc bpc" id="L553" title="1 of 2 branches missed.">    if (configOverrides.containsKey(key)) {</span>
<span class="nc" id="L554">      final String overrideHash = configOverrides.get(key);</span>
<span class="nc" id="L555">      return Optional.of(Hash.fromHexString(overrideHash));</span>
    } else {
<span class="fc" id="L557">      return JsonUtil.getValueAsString(configRoot, key).map(Hash::fromHexString);</span>
    }
  }

  @Override
  public List&lt;Long&gt; getForkBlockNumbers() {
<span class="fc" id="L563">    Stream&lt;OptionalLong&gt; forkBlockNumbers =</span>
<span class="fc" id="L564">        Stream.of(</span>
<span class="fc" id="L565">            getHomesteadBlockNumber(),</span>
<span class="fc" id="L566">            getDaoForkBlock(),</span>
<span class="fc" id="L567">            getTangerineWhistleBlockNumber(),</span>
<span class="fc" id="L568">            getSpuriousDragonBlockNumber(),</span>
<span class="fc" id="L569">            getByzantiumBlockNumber(),</span>
<span class="fc" id="L570">            getConstantinopleBlockNumber(),</span>
<span class="fc" id="L571">            getPetersburgBlockNumber(),</span>
<span class="fc" id="L572">            getIstanbulBlockNumber(),</span>
<span class="fc" id="L573">            getMuirGlacierBlockNumber(),</span>
<span class="fc" id="L574">            getBerlinBlockNumber(),</span>
<span class="fc" id="L575">            getLondonBlockNumber(),</span>
<span class="fc" id="L576">            getArrowGlacierBlockNumber(),</span>
<span class="fc" id="L577">            getGrayGlacierBlockNumber(),</span>
<span class="fc" id="L578">            getMergeNetSplitBlockNumber(),</span>
<span class="fc" id="L579">            getEcip1015BlockNumber(),</span>
<span class="fc" id="L580">            getDieHardBlockNumber(),</span>
<span class="fc" id="L581">            getGothamBlockNumber(),</span>
<span class="fc" id="L582">            getDefuseDifficultyBombBlockNumber(),</span>
<span class="fc" id="L583">            getAtlantisBlockNumber(),</span>
<span class="fc" id="L584">            getAghartaBlockNumber(),</span>
<span class="fc" id="L585">            getPhoenixBlockNumber(),</span>
<span class="fc" id="L586">            getThanosBlockNumber(),</span>
<span class="fc" id="L587">            getMagnetoBlockNumber(),</span>
<span class="fc" id="L588">            getMystiqueBlockNumber(),</span>
<span class="fc" id="L589">            getSpiralBlockNumber());</span>
    // when adding forks add an entry to ${REPO_ROOT}/config/src/test/resources/all_forks.json

<span class="fc" id="L592">    return forkBlockNumbers</span>
<span class="fc" id="L593">        .filter(OptionalLong::isPresent)</span>
<span class="fc" id="L594">        .map(OptionalLong::getAsLong)</span>
<span class="fc" id="L595">        .distinct()</span>
<span class="fc" id="L596">        .sorted()</span>
<span class="fc" id="L597">        .toList();</span>
  }

  @Override
  public List&lt;Long&gt; getForkBlockTimestamps() {
<span class="fc" id="L602">    Stream&lt;OptionalLong&gt; forkBlockTimestamps =</span>
<span class="fc" id="L603">        Stream.of(</span>
<span class="fc" id="L604">            getShanghaiTime(),</span>
<span class="fc" id="L605">            getCancunTime(),</span>
<span class="fc" id="L606">            getPragueTime(),</span>
<span class="fc" id="L607">            getFutureEipsTime(),</span>
<span class="fc" id="L608">            getExperimentalEipsTime());</span>
    // when adding forks add an entry to ${REPO_ROOT}/config/src/test/resources/all_forks.json

<span class="fc" id="L611">    return forkBlockTimestamps</span>
<span class="fc" id="L612">        .filter(OptionalLong::isPresent)</span>
<span class="fc" id="L613">        .map(OptionalLong::getAsLong)</span>
<span class="fc" id="L614">        .distinct()</span>
<span class="fc" id="L615">        .sorted()</span>
<span class="fc" id="L616">        .toList();</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>