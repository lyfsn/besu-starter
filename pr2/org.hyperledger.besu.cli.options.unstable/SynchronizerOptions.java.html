<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SynchronizerOptions.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">besu</a> &gt; <a href="index.source.html" class="el_package">org.hyperledger.besu.cli.options.unstable</a> &gt; <span class="el_source">SynchronizerOptions.java</span></div><h1>SynchronizerOptions.java</h1><pre class="source lang-java linenums">/*
 * Copyright ConsenSys AG.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except in compliance with
 * the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on
 * an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */
package org.hyperledger.besu.cli.options.unstable;

import org.hyperledger.besu.cli.options.CLIOptions;
import org.hyperledger.besu.cli.options.OptionParser;
import org.hyperledger.besu.ethereum.eth.sync.SynchronizerConfiguration;
import org.hyperledger.besu.ethereum.eth.sync.snapsync.ImmutableSnapSyncConfiguration;
import org.hyperledger.besu.ethereum.eth.sync.snapsync.SnapSyncConfiguration;

import java.util.Arrays;
import java.util.List;

import com.google.common.collect.Range;
import org.apache.tuweni.units.bigints.UInt256;
import picocli.CommandLine;

/** The Synchronizer Cli options. */
public class SynchronizerOptions implements CLIOptions&lt;SynchronizerConfiguration.Builder&gt; {
  private static final String BLOCK_PROPAGATION_RANGE_FLAG =
      &quot;--Xsynchronizer-block-propagation-range&quot;;
  private static final String DOWNLOADER_CHANGE_TARGET_THRESHOLD_BY_HEIGHT_FLAG =
      &quot;--Xsynchronizer-downloader-change-target-threshold-by-height&quot;;
  private static final String DOWNLOADER_CHANGE_TARGET_THRESHOLD_BY_TD_FLAG =
      &quot;--Xsynchronizer-downloader-change-target-threshold-by-td&quot;;
  private static final String DOWNLOADER_HEADER_REQUEST_SIZE_FLAG =
      &quot;--Xsynchronizer-downloader-header-request-size&quot;;
  private static final String DOWNLOADER_CHECKPOINT_TIMEOUTS_PERMITTED_FLAG =
      &quot;--Xsynchronizer-downloader-checkpoint-timeouts-permitted&quot;;
  private static final String DOWNLOADER_CHAIN_SEGMENT_SIZE_FLAG =
      &quot;--Xsynchronizer-downloader-chain-segment-size&quot;;
  private static final String DOWNLOADER_PARALLELISM_FLAG =
      &quot;--Xsynchronizer-downloader-parallelism&quot;;
  private static final String TRANSACTIONS_PARALLELISM_FLAG =
      &quot;--Xsynchronizer-transactions-parallelism&quot;;
  private static final String COMPUTATION_PARALLELISM_FLAG =
      &quot;--Xsynchronizer-computation-parallelism&quot;;
  private static final String PIVOT_DISTANCE_FROM_HEAD_FLAG =
      &quot;--Xsynchronizer-fast-sync-pivot-distance&quot;;
  private static final String FULL_VALIDATION_RATE_FLAG =
      &quot;--Xsynchronizer-fast-sync-full-validation-rate&quot;;
  private static final String WORLD_STATE_HASH_COUNT_PER_REQUEST_FLAG =
      &quot;--Xsynchronizer-world-state-hash-count-per-request&quot;;
  private static final String WORLD_STATE_REQUEST_PARALLELISM_FLAG =
      &quot;--Xsynchronizer-world-state-request-parallelism&quot;;
  private static final String WORLD_STATE_MAX_REQUESTS_WITHOUT_PROGRESS_FLAG =
      &quot;--Xsynchronizer-world-state-max-requests-without-progress&quot;;
  private static final String WORLD_STATE_MIN_MILLIS_BEFORE_STALLING_FLAG =
      &quot;--Xsynchronizer-world-state-min-millis-before-stalling&quot;;
  private static final String WORLD_STATE_TASK_CACHE_SIZE_FLAG =
      &quot;--Xsynchronizer-world-state-task-cache-size&quot;;

  private static final String SNAP_PIVOT_BLOCK_WINDOW_VALIDITY_FLAG =
      &quot;--Xsnapsync-synchronizer-pivot-block-window-validity&quot;;
  private static final String SNAP_PIVOT_BLOCK_DISTANCE_BEFORE_CACHING_FLAG =
      &quot;--Xsnapsync-synchronizer-pivot-block-distance-before-caching&quot;;
  private static final String SNAP_STORAGE_COUNT_PER_REQUEST_FLAG =
      &quot;--Xsnapsync-synchronizer-storage-count-per-request&quot;;
  private static final String SNAP_BYTECODE_COUNT_PER_REQUEST_FLAG =
      &quot;--Xsnapsync-synchronizer-bytecode-count-per-request&quot;;
  private static final String SNAP_TRIENODE_COUNT_PER_REQUEST_FLAG =
      &quot;--Xsnapsync-synchronizer-trienode-count-per-request&quot;;

  private static final String SNAP_FLAT_ACCOUNT_HEALED_COUNT_PER_REQUEST_FLAG =
      &quot;--Xsnapsync-synchronizer-flat-account-healed-count-per-request&quot;;

  private static final String SNAP_FLAT_STORAGE_HEALED_COUNT_PER_REQUEST_FLAG =
      &quot;--Xsnapsync-synchronizer-flat-slot-healed-count-per-request&quot;;

  private static final String SNAP_FLAT_DB_HEALING_ENABLED_FLAG =
      &quot;--Xsnapsync-synchronizer-flat-db-healing-enabled&quot;;

  private static final String SNAP_SERVER_ENABLED_FLAG = &quot;--Xsnapsync-server-enabled&quot;;

  private static final String CHECKPOINT_POST_MERGE_FLAG = &quot;--Xcheckpoint-post-merge-enabled&quot;;

  /**
   * Parse block propagation range.
   *
   * @param arg the range such as -10..30
   */
  @CommandLine.Option(
      names = BLOCK_PROPAGATION_RANGE_FLAG,
      hidden = true,
      defaultValue = &quot;-10..30&quot;,
      paramLabel = &quot;&lt;LONG&gt;..&lt;LONG&gt;&quot;,
      description =
          &quot;Range around chain head where inbound blocks are propagated (default: ${DEFAULT-VALUE})&quot;)
  public void parseBlockPropagationRange(final String arg) {
<span class="fc" id="L102">    blockPropagationRange = OptionParser.parseLongRange(arg);</span>
<span class="fc" id="L103">  }</span>

<span class="fc" id="L105">  private Range&lt;Long&gt; blockPropagationRange =</span>
      SynchronizerConfiguration.DEFAULT_BLOCK_PROPAGATION_RANGE;

<span class="fc" id="L108">  @CommandLine.Option(</span>
      names = DOWNLOADER_CHANGE_TARGET_THRESHOLD_BY_HEIGHT_FLAG,
      hidden = true,
      paramLabel = &quot;&lt;LONG&gt;&quot;,
      description =
          &quot;Minimum height difference before switching fast sync download peers (default: ${DEFAULT-VALUE})&quot;)
  private long downloaderChangeTargetThresholdByHeight =
      SynchronizerConfiguration.DEFAULT_DOWNLOADER_CHANGE_TARGET_THRESHOLD_BY_HEIGHT;

<span class="fc" id="L117">  @CommandLine.Option(</span>
      names = DOWNLOADER_CHANGE_TARGET_THRESHOLD_BY_TD_FLAG,
      hidden = true,
      paramLabel = &quot;&lt;UINT256&gt;&quot;,
      description =
          &quot;Minimum total difficulty difference before switching fast sync download peers (default: ${DEFAULT-VALUE})&quot;)
  private UInt256 downloaderChangeTargetThresholdByTd =
      SynchronizerConfiguration.DEFAULT_DOWNLOADER_CHANGE_TARGET_THRESHOLD_BY_TD;

<span class="fc" id="L126">  @CommandLine.Option(</span>
      names = DOWNLOADER_HEADER_REQUEST_SIZE_FLAG,
      hidden = true,
      paramLabel = &quot;&lt;INTEGER&gt;&quot;,
      description = &quot;Number of headers to request per packet (default: ${DEFAULT-VALUE})&quot;)
  private int downloaderHeaderRequestSize =
      SynchronizerConfiguration.DEFAULT_DOWNLOADER_HEADER_REQUEST_SIZE;

<span class="fc" id="L134">  @CommandLine.Option(</span>
      names = DOWNLOADER_CHECKPOINT_TIMEOUTS_PERMITTED_FLAG,
      hidden = true,
      paramLabel = &quot;&lt;INTEGER&gt;&quot;,
      description =
          &quot;Number of tries to attempt to download checkpoints before stopping (default: ${DEFAULT-VALUE})&quot;)
  private int downloaderCheckpointTimeoutsPermitted =
      SynchronizerConfiguration.DEFAULT_DOWNLOADER_CHECKPOINT_TIMEOUTS_PERMITTED;

<span class="fc" id="L143">  @CommandLine.Option(</span>
      names = DOWNLOADER_CHAIN_SEGMENT_SIZE_FLAG,
      hidden = true,
      paramLabel = &quot;&lt;INTEGER&gt;&quot;,
      description = &quot;Distance between checkpoint headers (default: ${DEFAULT-VALUE})&quot;)
  private int downloaderChainSegmentSize =
      SynchronizerConfiguration.DEFAULT_DOWNLOADER_CHAIN_SEGMENT_SIZE;

<span class="fc" id="L151">  @CommandLine.Option(</span>
      names = DOWNLOADER_PARALLELISM_FLAG,
      hidden = true,
      paramLabel = &quot;&lt;INTEGER&gt;&quot;,
      description = &quot;Number of threads to provide to chain downloader (default: ${DEFAULT-VALUE})&quot;)
  private int downloaderParallelism = SynchronizerConfiguration.DEFAULT_DOWNLOADER_PARALLELISM;

<span class="fc" id="L158">  @CommandLine.Option(</span>
      names = TRANSACTIONS_PARALLELISM_FLAG,
      hidden = true,
      paramLabel = &quot;&lt;INTEGER&gt;&quot;,
      description =
          &quot;Number of threads to commit to transaction processing (default: ${DEFAULT-VALUE})&quot;)
  private int transactionsParallelism = SynchronizerConfiguration.DEFAULT_TRANSACTIONS_PARALLELISM;

<span class="fc" id="L166">  @CommandLine.Option(</span>
      names = COMPUTATION_PARALLELISM_FLAG,
      hidden = true,
      paramLabel = &quot;&lt;INTEGER&gt;&quot;,
      description =
          &quot;Number of threads to make available for bulk hash computations during downloads (default: # of processors)&quot;)
<span class="fc" id="L172">  private int computationParallelism = Runtime.getRuntime().availableProcessors();</span>

<span class="fc" id="L174">  @CommandLine.Option(</span>
      names = PIVOT_DISTANCE_FROM_HEAD_FLAG,
      hidden = true,
      paramLabel = &quot;&lt;INTEGER&gt;&quot;,
      description =
          &quot;Distance from initial chain head to fast sync target (default: ${DEFAULT-VALUE})&quot;)
  private int fastSyncPivotDistance = SynchronizerConfiguration.DEFAULT_PIVOT_DISTANCE_FROM_HEAD;

<span class="fc" id="L182">  @CommandLine.Option(</span>
      names = FULL_VALIDATION_RATE_FLAG,
      hidden = true,
      paramLabel = &quot;&lt;FLOAT&gt;&quot;,
      description = &quot;Fraction of headers fast sync will fully validate (default: ${DEFAULT-VALUE})&quot;)
  private float fastSyncFullValidationRate = SynchronizerConfiguration.DEFAULT_FULL_VALIDATION_RATE;

<span class="fc" id="L189">  @CommandLine.Option(</span>
      names = WORLD_STATE_HASH_COUNT_PER_REQUEST_FLAG,
      hidden = true,
      paramLabel = &quot;&lt;INTEGER&gt;&quot;,
      description = &quot;Fast sync world state hashes queried per request (default: ${DEFAULT-VALUE})&quot;)
  private int worldStateHashCountPerRequest =
      SynchronizerConfiguration.DEFAULT_WORLD_STATE_HASH_COUNT_PER_REQUEST;

<span class="fc" id="L197">  @CommandLine.Option(</span>
      names = WORLD_STATE_REQUEST_PARALLELISM_FLAG,
      hidden = true,
      paramLabel = &quot;&lt;INTEGER&gt;&quot;,
      description =
          &quot;Number of concurrent requests to use when downloading fast sync world state (default: ${DEFAULT-VALUE})&quot;)
  private int worldStateRequestParallelism =
      SynchronizerConfiguration.DEFAULT_WORLD_STATE_REQUEST_PARALLELISM;

<span class="fc" id="L206">  @CommandLine.Option(</span>
      names = WORLD_STATE_MAX_REQUESTS_WITHOUT_PROGRESS_FLAG,
      hidden = true,
      paramLabel = &quot;&lt;INTEGER&gt;&quot;,
      description =
          &quot;Number of world state requests accepted without progress before considering the download stalled (default: ${DEFAULT-VALUE})&quot;)
  private int worldStateMaxRequestsWithoutProgress =
      SynchronizerConfiguration.DEFAULT_WORLD_STATE_MAX_REQUESTS_WITHOUT_PROGRESS;

<span class="fc" id="L215">  @CommandLine.Option(</span>
      names = WORLD_STATE_MIN_MILLIS_BEFORE_STALLING_FLAG,
      hidden = true,
      paramLabel = &quot;&lt;LONG&gt;&quot;,
      description =
          &quot;Minimum time in ms without progress before considering a world state download as stalled (default: ${DEFAULT-VALUE})&quot;)
  private long worldStateMinMillisBeforeStalling =
      SynchronizerConfiguration.DEFAULT_WORLD_STATE_MIN_MILLIS_BEFORE_STALLING;

<span class="fc" id="L224">  @CommandLine.Option(</span>
      names = WORLD_STATE_TASK_CACHE_SIZE_FLAG,
      hidden = true,
      paramLabel = &quot;&lt;INTEGER&gt;&quot;,
      description =
          &quot;The max number of pending node data requests cached in-memory during fast sync world state download. (default: ${DEFAULT-VALUE})&quot;)
  private int worldStateTaskCacheSize =
      SynchronizerConfiguration.DEFAULT_WORLD_STATE_TASK_CACHE_SIZE;

<span class="fc" id="L233">  @CommandLine.Option(</span>
      names = SNAP_PIVOT_BLOCK_WINDOW_VALIDITY_FLAG,
      hidden = true,
      paramLabel = &quot;&lt;INTEGER&gt;&quot;,
      description =
          &quot;The size of the pivot block window before having to change it (default: ${DEFAULT-VALUE})&quot;)
  private int snapsyncPivotBlockWindowValidity =
      SnapSyncConfiguration.DEFAULT_PIVOT_BLOCK_WINDOW_VALIDITY;

<span class="fc" id="L242">  @CommandLine.Option(</span>
      names = SNAP_PIVOT_BLOCK_DISTANCE_BEFORE_CACHING_FLAG,
      hidden = true,
      paramLabel = &quot;&lt;INTEGER&gt;&quot;,
      description =
          &quot;The distance from the head before loading a pivot block into the cache to have a ready pivot block when the window is finished (default: ${DEFAULT-VALUE})&quot;)
  private int snapsyncPivotBlockDistanceBeforeCaching =
      SnapSyncConfiguration.DEFAULT_PIVOT_BLOCK_DISTANCE_BEFORE_CACHING;

<span class="fc" id="L251">  @CommandLine.Option(</span>
      names = SNAP_STORAGE_COUNT_PER_REQUEST_FLAG,
      hidden = true,
      paramLabel = &quot;&lt;INTEGER&gt;&quot;,
      description = &quot;Snap sync storage queried per request (default: ${DEFAULT-VALUE})&quot;)
  private int snapsyncStorageCountPerRequest =
      SnapSyncConfiguration.DEFAULT_STORAGE_COUNT_PER_REQUEST;

<span class="fc" id="L259">  @CommandLine.Option(</span>
      names = SNAP_BYTECODE_COUNT_PER_REQUEST_FLAG,
      hidden = true,
      paramLabel = &quot;&lt;INTEGER&gt;&quot;,
      description = &quot;Snap sync bytecode queried per request (default: ${DEFAULT-VALUE})&quot;)
  private int snapsyncBytecodeCountPerRequest =
      SnapSyncConfiguration.DEFAULT_BYTECODE_COUNT_PER_REQUEST;

<span class="fc" id="L267">  @CommandLine.Option(</span>
      names = SNAP_TRIENODE_COUNT_PER_REQUEST_FLAG,
      hidden = true,
      paramLabel = &quot;&lt;INTEGER&gt;&quot;,
      description = &quot;Snap sync trie node queried per request (default: ${DEFAULT-VALUE})&quot;)
  private int snapsyncTrieNodeCountPerRequest =
      SnapSyncConfiguration.DEFAULT_TRIENODE_COUNT_PER_REQUEST;

<span class="fc" id="L275">  @CommandLine.Option(</span>
      names = SNAP_FLAT_ACCOUNT_HEALED_COUNT_PER_REQUEST_FLAG,
      hidden = true,
      paramLabel = &quot;&lt;INTEGER&gt;&quot;,
      description =
          &quot;Snap sync flat accounts verified and healed per request (default: ${DEFAULT-VALUE})&quot;)
  private int snapsyncFlatAccountHealedCountPerRequest =
      SnapSyncConfiguration.DEFAULT_LOCAL_FLAT_ACCOUNT_COUNT_TO_HEAL_PER_REQUEST;

<span class="fc" id="L284">  @CommandLine.Option(</span>
      names = SNAP_FLAT_STORAGE_HEALED_COUNT_PER_REQUEST_FLAG,
      hidden = true,
      paramLabel = &quot;&lt;INTEGER&gt;&quot;,
      description =
          &quot;Snap sync flat slots verified and healed per request (default: ${DEFAULT-VALUE})&quot;)
  private int snapsyncFlatStorageHealedCountPerRequest =
      SnapSyncConfiguration.DEFAULT_LOCAL_FLAT_STORAGE_COUNT_TO_HEAL_PER_REQUEST;

<span class="fc" id="L293">  @CommandLine.Option(</span>
      names = SNAP_FLAT_DB_HEALING_ENABLED_FLAG,
      hidden = true,
      paramLabel = &quot;&lt;Boolean&gt;&quot;,
      description = &quot;Snap sync flat db healing enabled (default: ${DEFAULT-VALUE})&quot;)
  private Boolean snapsyncFlatDbHealingEnabled =
      SnapSyncConfiguration.DEFAULT_IS_FLAT_DB_HEALING_ENABLED;

<span class="fc" id="L301">  @CommandLine.Option(</span>
      names = SNAP_SERVER_ENABLED_FLAG,
      hidden = true,
      paramLabel = &quot;&lt;Boolean&gt;&quot;,
      description = &quot;Snap sync server enabled (default: ${DEFAULT-VALUE})&quot;)
  private Boolean snapsyncServerEnabled = SnapSyncConfiguration.DEFAULT_SNAP_SERVER_ENABLED;

<span class="fc" id="L308">  @CommandLine.Option(</span>
      names = {CHECKPOINT_POST_MERGE_FLAG},
      hidden = true,
      description = &quot;Enable the sync to start from a post-merge block.&quot;)
  private Boolean checkpointPostMergeSyncEnabled =
<span class="fc" id="L313">      SynchronizerConfiguration.DEFAULT_CHECKPOINT_POST_MERGE_ENABLED;</span>

<span class="fc" id="L315">  private SynchronizerOptions() {}</span>

  /**
   * Flag to know whether the flat db healing feature is enabled or disabled.
   *
   * @return true is the flat db healing is enabled
   */
  public boolean isSnapsyncFlatDbHealingEnabled() {
<span class="fc" id="L323">    return snapsyncFlatDbHealingEnabled;</span>
  }

  /**
   * Flag to know whether the Snap sync server feature is enabled or disabled.
   *
   * @return true if snap sync server is enabled
   */
  public boolean isSnapsyncServerEnabled() {
<span class="fc" id="L332">    return snapsyncServerEnabled;</span>
  }

  /**
   * Create synchronizer options.
   *
   * @return the synchronizer options
   */
  public static SynchronizerOptions create() {
<span class="fc" id="L341">    return new SynchronizerOptions();</span>
  }

  /**
   * Create synchronizer options from Synchronizer Configuration.
   *
   * @param config the Synchronizer Configuration
   * @return the synchronizer options
   */
  public static SynchronizerOptions fromConfig(final SynchronizerConfiguration config) {
<span class="fc" id="L351">    final SynchronizerOptions options = new SynchronizerOptions();</span>
<span class="fc" id="L352">    options.blockPropagationRange = config.getBlockPropagationRange();</span>
<span class="fc" id="L353">    options.downloaderChangeTargetThresholdByHeight =</span>
<span class="fc" id="L354">        config.getDownloaderChangeTargetThresholdByHeight();</span>
<span class="fc" id="L355">    options.downloaderChangeTargetThresholdByTd = config.getDownloaderChangeTargetThresholdByTd();</span>
<span class="fc" id="L356">    options.downloaderHeaderRequestSize = config.getDownloaderHeaderRequestSize();</span>
<span class="fc" id="L357">    options.downloaderCheckpointTimeoutsPermitted =</span>
<span class="fc" id="L358">        config.getDownloaderCheckpointTimeoutsPermitted();</span>
<span class="fc" id="L359">    options.downloaderChainSegmentSize = config.getDownloaderChainSegmentSize();</span>
<span class="fc" id="L360">    options.downloaderParallelism = config.getDownloaderParallelism();</span>
<span class="fc" id="L361">    options.transactionsParallelism = config.getTransactionsParallelism();</span>
<span class="fc" id="L362">    options.computationParallelism = config.getComputationParallelism();</span>
<span class="fc" id="L363">    options.fastSyncPivotDistance = config.getFastSyncPivotDistance();</span>
<span class="fc" id="L364">    options.fastSyncFullValidationRate = config.getFastSyncFullValidationRate();</span>
<span class="fc" id="L365">    options.worldStateHashCountPerRequest = config.getWorldStateHashCountPerRequest();</span>
<span class="fc" id="L366">    options.worldStateRequestParallelism = config.getWorldStateRequestParallelism();</span>
<span class="fc" id="L367">    options.worldStateMaxRequestsWithoutProgress = config.getWorldStateMaxRequestsWithoutProgress();</span>
<span class="fc" id="L368">    options.worldStateMinMillisBeforeStalling = config.getWorldStateMinMillisBeforeStalling();</span>
<span class="fc" id="L369">    options.worldStateTaskCacheSize = config.getWorldStateTaskCacheSize();</span>
<span class="fc" id="L370">    options.snapsyncPivotBlockWindowValidity =</span>
<span class="fc" id="L371">        config.getSnapSyncConfiguration().getPivotBlockWindowValidity();</span>
<span class="fc" id="L372">    options.snapsyncPivotBlockDistanceBeforeCaching =</span>
<span class="fc" id="L373">        config.getSnapSyncConfiguration().getPivotBlockDistanceBeforeCaching();</span>
<span class="fc" id="L374">    options.snapsyncStorageCountPerRequest =</span>
<span class="fc" id="L375">        config.getSnapSyncConfiguration().getStorageCountPerRequest();</span>
<span class="fc" id="L376">    options.snapsyncBytecodeCountPerRequest =</span>
<span class="fc" id="L377">        config.getSnapSyncConfiguration().getBytecodeCountPerRequest();</span>
<span class="fc" id="L378">    options.snapsyncTrieNodeCountPerRequest =</span>
<span class="fc" id="L379">        config.getSnapSyncConfiguration().getTrienodeCountPerRequest();</span>
<span class="fc" id="L380">    options.snapsyncFlatAccountHealedCountPerRequest =</span>
<span class="fc" id="L381">        config.getSnapSyncConfiguration().getLocalFlatAccountCountToHealPerRequest();</span>
<span class="fc" id="L382">    options.snapsyncFlatStorageHealedCountPerRequest =</span>
<span class="fc" id="L383">        config.getSnapSyncConfiguration().getLocalFlatStorageCountToHealPerRequest();</span>
<span class="fc" id="L384">    options.snapsyncFlatDbHealingEnabled =</span>
<span class="fc" id="L385">        config.getSnapSyncConfiguration().isFlatDbHealingEnabled();</span>
<span class="fc" id="L386">    options.checkpointPostMergeSyncEnabled = config.isCheckpointPostMergeEnabled();</span>
<span class="fc" id="L387">    return options;</span>
  }

  @Override
  public SynchronizerConfiguration.Builder toDomainObject() {
<span class="fc" id="L392">    final SynchronizerConfiguration.Builder builder = SynchronizerConfiguration.builder();</span>
<span class="fc" id="L393">    builder.blockPropagationRange(blockPropagationRange);</span>
<span class="fc" id="L394">    builder.downloaderChangeTargetThresholdByHeight(downloaderChangeTargetThresholdByHeight);</span>
<span class="fc" id="L395">    builder.downloaderChangeTargetThresholdByTd(downloaderChangeTargetThresholdByTd);</span>
<span class="fc" id="L396">    builder.downloaderHeadersRequestSize(downloaderHeaderRequestSize);</span>
<span class="fc" id="L397">    builder.downloaderCheckpointTimeoutsPermitted(downloaderCheckpointTimeoutsPermitted);</span>
<span class="fc" id="L398">    builder.downloaderChainSegmentSize(downloaderChainSegmentSize);</span>
<span class="fc" id="L399">    builder.downloaderParallelism(downloaderParallelism);</span>
<span class="fc" id="L400">    builder.transactionsParallelism(transactionsParallelism);</span>
<span class="fc" id="L401">    builder.computationParallelism(computationParallelism);</span>
<span class="fc" id="L402">    builder.fastSyncPivotDistance(fastSyncPivotDistance);</span>
<span class="fc" id="L403">    builder.fastSyncFullValidationRate(fastSyncFullValidationRate);</span>
<span class="fc" id="L404">    builder.worldStateHashCountPerRequest(worldStateHashCountPerRequest);</span>
<span class="fc" id="L405">    builder.worldStateRequestParallelism(worldStateRequestParallelism);</span>
<span class="fc" id="L406">    builder.worldStateMaxRequestsWithoutProgress(worldStateMaxRequestsWithoutProgress);</span>
<span class="fc" id="L407">    builder.worldStateMinMillisBeforeStalling(worldStateMinMillisBeforeStalling);</span>
<span class="fc" id="L408">    builder.worldStateTaskCacheSize(worldStateTaskCacheSize);</span>
<span class="fc" id="L409">    builder.snapSyncConfiguration(</span>
<span class="fc" id="L410">        ImmutableSnapSyncConfiguration.builder()</span>
<span class="fc" id="L411">            .pivotBlockWindowValidity(snapsyncPivotBlockWindowValidity)</span>
<span class="fc" id="L412">            .pivotBlockDistanceBeforeCaching(snapsyncPivotBlockDistanceBeforeCaching)</span>
<span class="fc" id="L413">            .storageCountPerRequest(snapsyncStorageCountPerRequest)</span>
<span class="fc" id="L414">            .bytecodeCountPerRequest(snapsyncBytecodeCountPerRequest)</span>
<span class="fc" id="L415">            .trienodeCountPerRequest(snapsyncTrieNodeCountPerRequest)</span>
<span class="fc" id="L416">            .localFlatAccountCountToHealPerRequest(snapsyncFlatAccountHealedCountPerRequest)</span>
<span class="fc" id="L417">            .localFlatStorageCountToHealPerRequest(snapsyncFlatStorageHealedCountPerRequest)</span>
<span class="fc" id="L418">            .isFlatDbHealingEnabled(snapsyncFlatDbHealingEnabled)</span>
<span class="fc" id="L419">            .isSnapServerEnabled(snapsyncServerEnabled)</span>
<span class="fc" id="L420">            .build());</span>
<span class="fc" id="L421">    builder.checkpointPostMergeEnabled(checkpointPostMergeSyncEnabled);</span>

<span class="fc" id="L423">    return builder;</span>
  }

  @Override
  public List&lt;String&gt; getCLIOptions() {
<span class="fc" id="L428">    List&lt;String&gt; value =</span>
<span class="fc" id="L429">        Arrays.asList(</span>
            BLOCK_PROPAGATION_RANGE_FLAG,
<span class="fc" id="L431">            OptionParser.format(blockPropagationRange),</span>
            DOWNLOADER_CHANGE_TARGET_THRESHOLD_BY_HEIGHT_FLAG,
<span class="fc" id="L433">            OptionParser.format(downloaderChangeTargetThresholdByHeight),</span>
            DOWNLOADER_CHANGE_TARGET_THRESHOLD_BY_TD_FLAG,
<span class="fc" id="L435">            OptionParser.format(downloaderChangeTargetThresholdByTd),</span>
            DOWNLOADER_HEADER_REQUEST_SIZE_FLAG,
<span class="fc" id="L437">            OptionParser.format(downloaderHeaderRequestSize),</span>
            DOWNLOADER_CHECKPOINT_TIMEOUTS_PERMITTED_FLAG,
<span class="fc" id="L439">            OptionParser.format(downloaderCheckpointTimeoutsPermitted),</span>
            DOWNLOADER_CHAIN_SEGMENT_SIZE_FLAG,
<span class="fc" id="L441">            OptionParser.format(downloaderChainSegmentSize),</span>
            DOWNLOADER_PARALLELISM_FLAG,
<span class="fc" id="L443">            OptionParser.format(downloaderParallelism),</span>
            TRANSACTIONS_PARALLELISM_FLAG,
<span class="fc" id="L445">            OptionParser.format(transactionsParallelism),</span>
            COMPUTATION_PARALLELISM_FLAG,
<span class="fc" id="L447">            OptionParser.format(computationParallelism),</span>
            PIVOT_DISTANCE_FROM_HEAD_FLAG,
<span class="fc" id="L449">            OptionParser.format(fastSyncPivotDistance),</span>
            FULL_VALIDATION_RATE_FLAG,
<span class="fc" id="L451">            OptionParser.format(fastSyncFullValidationRate),</span>
            WORLD_STATE_HASH_COUNT_PER_REQUEST_FLAG,
<span class="fc" id="L453">            OptionParser.format(worldStateHashCountPerRequest),</span>
            WORLD_STATE_REQUEST_PARALLELISM_FLAG,
<span class="fc" id="L455">            OptionParser.format(worldStateRequestParallelism),</span>
            WORLD_STATE_MAX_REQUESTS_WITHOUT_PROGRESS_FLAG,
<span class="fc" id="L457">            OptionParser.format(worldStateMaxRequestsWithoutProgress),</span>
            WORLD_STATE_MIN_MILLIS_BEFORE_STALLING_FLAG,
<span class="fc" id="L459">            OptionParser.format(worldStateMinMillisBeforeStalling),</span>
            WORLD_STATE_TASK_CACHE_SIZE_FLAG,
<span class="fc" id="L461">            OptionParser.format(worldStateTaskCacheSize),</span>
            SNAP_PIVOT_BLOCK_WINDOW_VALIDITY_FLAG,
<span class="fc" id="L463">            OptionParser.format(snapsyncPivotBlockWindowValidity),</span>
            SNAP_PIVOT_BLOCK_DISTANCE_BEFORE_CACHING_FLAG,
<span class="fc" id="L465">            OptionParser.format(snapsyncPivotBlockDistanceBeforeCaching),</span>
            SNAP_STORAGE_COUNT_PER_REQUEST_FLAG,
<span class="fc" id="L467">            OptionParser.format(snapsyncStorageCountPerRequest),</span>
            SNAP_BYTECODE_COUNT_PER_REQUEST_FLAG,
<span class="fc" id="L469">            OptionParser.format(snapsyncBytecodeCountPerRequest),</span>
            SNAP_TRIENODE_COUNT_PER_REQUEST_FLAG,
<span class="fc" id="L471">            OptionParser.format(snapsyncTrieNodeCountPerRequest));</span>
<span class="pc bpc" id="L472" title="1 of 2 branches missed.">    if (isSnapsyncFlatDbHealingEnabled()) {</span>
<span class="nc" id="L473">      value.addAll(</span>
<span class="nc" id="L474">          Arrays.asList(</span>
              SNAP_FLAT_ACCOUNT_HEALED_COUNT_PER_REQUEST_FLAG,
<span class="nc" id="L476">              OptionParser.format(snapsyncFlatAccountHealedCountPerRequest),</span>
              SNAP_FLAT_STORAGE_HEALED_COUNT_PER_REQUEST_FLAG,
<span class="nc" id="L478">              OptionParser.format(snapsyncFlatStorageHealedCountPerRequest),</span>
              SNAP_SERVER_ENABLED_FLAG,
<span class="nc" id="L480">              OptionParser.format(snapsyncServerEnabled)));</span>
    }
<span class="fc" id="L482">    return value;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>