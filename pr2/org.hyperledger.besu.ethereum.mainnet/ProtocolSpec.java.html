<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ProtocolSpec.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">besu</a> &gt; <a href="index.source.html" class="el_package">org.hyperledger.besu.ethereum.mainnet</a> &gt; <span class="el_source">ProtocolSpec.java</span></div><h1>ProtocolSpec.java</h1><pre class="source lang-java linenums">/*
 * Copyright ConsenSys AG.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except in compliance with
 * the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on
 * an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */
package org.hyperledger.besu.ethereum.mainnet;

import org.hyperledger.besu.datatypes.Wei;
import org.hyperledger.besu.ethereum.BlockValidator;
import org.hyperledger.besu.ethereum.GasLimitCalculator;
import org.hyperledger.besu.ethereum.core.BlockHeaderFunctions;
import org.hyperledger.besu.ethereum.core.BlockImporter;
import org.hyperledger.besu.ethereum.mainnet.feemarket.FeeMarket;
import org.hyperledger.besu.ethereum.privacy.PrivateTransactionProcessor;
import org.hyperledger.besu.evm.EVM;
import org.hyperledger.besu.evm.gascalculator.GasCalculator;
import org.hyperledger.besu.evm.precompile.PrecompileContractRegistry;

import java.util.Optional;

/** A protocol specification. */
public class ProtocolSpec {

  private final String name;
  private final EVM evm;

  private final GasCalculator gasCalculator;

  private final GasLimitCalculator gasLimitCalculator;

  private final TransactionValidatorFactory transactionValidatorFactory;

  private final MainnetTransactionProcessor transactionProcessor;

  private final BlockHeaderValidator blockHeaderValidator;

  private final BlockHeaderValidator ommerHeaderValidator;

  private final BlockBodyValidator blockBodyValidator;

  private final BlockImporter blockImporter;

  private final BlockValidator blockValidator;

  private final BlockProcessor blockProcessor;

  private final BlockHeaderFunctions blockHeaderFunctions;

  private final AbstractBlockProcessor.TransactionReceiptFactory transactionReceiptFactory;

  private final DifficultyCalculator difficultyCalculator;

  private final Wei blockReward;

  private final MiningBeneficiaryCalculator miningBeneficiaryCalculator;

  private final PrecompileContractRegistry precompileContractRegistry;

  private final boolean skipZeroBlockRewards;

  private final PrivateTransactionProcessor privateTransactionProcessor;

  private final FeeMarket feeMarket;

  private final Optional&lt;PoWHasher&gt; powHasher;

  private final WithdrawalsValidator withdrawalsValidator;
  private final Optional&lt;WithdrawalsProcessor&gt; withdrawalsProcessor;
  private final DepositsValidator depositsValidator;

  private final boolean isPoS;
  private final boolean isReplayProtectionSupported;
  /**
   * Creates a new protocol specification instance.
   *
   * @param name the protocol specification name
   * @param evm the EVM supporting the appropriate operations for this specification
   * @param transactionValidatorFactory the transaction validator factory to use
   * @param transactionProcessor the transaction processor to use
   * @param privateTransactionProcessor the private transaction processor to use
   * @param blockHeaderValidator the block header validator to use
   * @param ommerHeaderValidator the rules used to validate an ommer
   * @param blockBodyValidator the block body validator to use
   * @param blockProcessor the block processor to use
   * @param blockImporter the block importer to use
   * @param blockValidator the block validator to use
   * @param blockHeaderFunctions the block hash function to use
   * @param transactionReceiptFactory the transactionReceiptFactory to use
   * @param difficultyCalculator the difficultyCalculator to use
   * @param blockReward the blockReward to use.
   * @param miningBeneficiaryCalculator determines to whom mining proceeds are paid
   * @param precompileContractRegistry all the pre-compiled contracts added
   * @param skipZeroBlockRewards should rewards be skipped if it is zero
   * @param gasCalculator the gas calculator to use.
   * @param gasLimitCalculator the gas limit calculator to use.
   * @param feeMarket an {@link Optional} wrapping {@link FeeMarket} class if appropriate.
   * @param powHasher the proof-of-work hasher
   * @param withdrawalsValidator the withdrawals validator to use
   * @param withdrawalsProcessor the Withdrawals processor to use
   * @param depositsValidator the withdrawals validator to use
   * @param isPoS indicates whether the current spec is PoS
   * @param isReplayProtectionSupported indicates whether the current spec supports replay
   *     protection
   */
  public ProtocolSpec(
      final String name,
      final EVM evm,
      final TransactionValidatorFactory transactionValidatorFactory,
      final MainnetTransactionProcessor transactionProcessor,
      final PrivateTransactionProcessor privateTransactionProcessor,
      final BlockHeaderValidator blockHeaderValidator,
      final BlockHeaderValidator ommerHeaderValidator,
      final BlockBodyValidator blockBodyValidator,
      final BlockProcessor blockProcessor,
      final BlockImporter blockImporter,
      final BlockValidator blockValidator,
      final BlockHeaderFunctions blockHeaderFunctions,
      final AbstractBlockProcessor.TransactionReceiptFactory transactionReceiptFactory,
      final DifficultyCalculator difficultyCalculator,
      final Wei blockReward,
      final MiningBeneficiaryCalculator miningBeneficiaryCalculator,
      final PrecompileContractRegistry precompileContractRegistry,
      final boolean skipZeroBlockRewards,
      final GasCalculator gasCalculator,
      final GasLimitCalculator gasLimitCalculator,
      final FeeMarket feeMarket,
      final Optional&lt;PoWHasher&gt; powHasher,
      final WithdrawalsValidator withdrawalsValidator,
      final Optional&lt;WithdrawalsProcessor&gt; withdrawalsProcessor,
      final DepositsValidator depositsValidator,
      final boolean isPoS,
<span class="fc" id="L141">      final boolean isReplayProtectionSupported) {</span>
<span class="fc" id="L142">    this.name = name;</span>
<span class="fc" id="L143">    this.evm = evm;</span>
<span class="fc" id="L144">    this.transactionValidatorFactory = transactionValidatorFactory;</span>
<span class="fc" id="L145">    this.transactionProcessor = transactionProcessor;</span>
<span class="fc" id="L146">    this.privateTransactionProcessor = privateTransactionProcessor;</span>
<span class="fc" id="L147">    this.blockHeaderValidator = blockHeaderValidator;</span>
<span class="fc" id="L148">    this.ommerHeaderValidator = ommerHeaderValidator;</span>
<span class="fc" id="L149">    this.blockBodyValidator = blockBodyValidator;</span>
<span class="fc" id="L150">    this.blockProcessor = blockProcessor;</span>
<span class="fc" id="L151">    this.blockImporter = blockImporter;</span>
<span class="fc" id="L152">    this.blockValidator = blockValidator;</span>
<span class="fc" id="L153">    this.blockHeaderFunctions = blockHeaderFunctions;</span>
<span class="fc" id="L154">    this.transactionReceiptFactory = transactionReceiptFactory;</span>
<span class="fc" id="L155">    this.difficultyCalculator = difficultyCalculator;</span>
<span class="fc" id="L156">    this.blockReward = blockReward;</span>
<span class="fc" id="L157">    this.miningBeneficiaryCalculator = miningBeneficiaryCalculator;</span>
<span class="fc" id="L158">    this.precompileContractRegistry = precompileContractRegistry;</span>
<span class="fc" id="L159">    this.skipZeroBlockRewards = skipZeroBlockRewards;</span>
<span class="fc" id="L160">    this.gasCalculator = gasCalculator;</span>
<span class="fc" id="L161">    this.gasLimitCalculator = gasLimitCalculator;</span>
<span class="fc" id="L162">    this.feeMarket = feeMarket;</span>
<span class="fc" id="L163">    this.powHasher = powHasher;</span>
<span class="fc" id="L164">    this.withdrawalsValidator = withdrawalsValidator;</span>
<span class="fc" id="L165">    this.withdrawalsProcessor = withdrawalsProcessor;</span>
<span class="fc" id="L166">    this.depositsValidator = depositsValidator;</span>
<span class="fc" id="L167">    this.isPoS = isPoS;</span>
<span class="fc" id="L168">    this.isReplayProtectionSupported = isReplayProtectionSupported;</span>
<span class="fc" id="L169">  }</span>

  /**
   * Returns the protocol specification name.
   *
   * @return the protocol specification name
   */
  public String getName() {
<span class="fc" id="L177">    return name;</span>
  }

  /**
   * Returns the transaction validator factory used in this specification.
   *
   * @return the transaction validator factory
   */
  public TransactionValidatorFactory getTransactionValidatorFactory() {
<span class="fc" id="L186">    return transactionValidatorFactory;</span>
  }

  public boolean isReplayProtectionSupported() {
<span class="nc" id="L190">    return isReplayProtectionSupported;</span>
  }

  /**
   * Returns the transaction processor used in this specification.
   *
   * @return the transaction processor
   */
  public MainnetTransactionProcessor getTransactionProcessor() {
<span class="fc" id="L199">    return transactionProcessor;</span>
  }

  /**
   * Returns the block processor used in this specification.
   *
   * @return the block processor
   */
  public BlockProcessor getBlockProcessor() {
<span class="fc" id="L208">    return blockProcessor;</span>
  }

  /**
   * Returns the block importer used in this specification.
   *
   * @return the block importer
   */
  public BlockImporter getBlockImporter() {
<span class="fc" id="L217">    return blockImporter;</span>
  }

  /**
   * Returns the block validator used in this specification.
   *
   * @return the block validator
   */
  public BlockValidator getBlockValidator() {
<span class="fc" id="L226">    return blockValidator;</span>
  }

  /**
   * Returns the block header validator used in this specification.
   *
   * @return the block header validator
   */
  public BlockHeaderValidator getBlockHeaderValidator() {
<span class="fc" id="L235">    return blockHeaderValidator;</span>
  }

  /**
   * Returns the block ommer header validator used in this specification.
   *
   * @return the block ommer header validator
   */
  public BlockHeaderValidator getOmmerHeaderValidator() {
<span class="fc" id="L244">    return ommerHeaderValidator;</span>
  }

  /**
   * Returns the block body validator used in this specification.
   *
   * @return the block body validator
   */
  public BlockBodyValidator getBlockBodyValidator() {
<span class="nc" id="L253">    return blockBodyValidator;</span>
  }

  /**
   * Returns the block hash function used in this specification.
   *
   * @return the block hash function
   */
  public BlockHeaderFunctions getBlockHeaderFunctions() {
<span class="fc" id="L262">    return blockHeaderFunctions;</span>
  }

  /**
   * Returns the EVM for this specification.
   *
   * @return the EVM
   */
  public EVM getEvm() {
<span class="fc" id="L271">    return evm;</span>
  }

  /**
   * Returns the TransctionReceiptFactory used in this specification
   *
   * @return the transaction receipt factory
   */
  public AbstractBlockProcessor.TransactionReceiptFactory getTransactionReceiptFactory() {
<span class="fc" id="L280">    return transactionReceiptFactory;</span>
  }

  /**
   * Returns the DifficultyCalculator used in this specification.
   *
   * @return the difficulty calculator.
   */
  public DifficultyCalculator getDifficultyCalculator() {
<span class="fc" id="L289">    return difficultyCalculator;</span>
  }

  /**
   * Returns the blockReward used in this specification.
   *
   * @return the amount to be rewarded for block mining.
   */
  public Wei getBlockReward() {
<span class="fc" id="L298">    return blockReward;</span>
  }

  /**
   * Sometimes we apply zero block rewards to the Trie (pre EIP158) sometimes we don't (post EIP158
   * and all clique nets). The initial behavior was to never apply zero rewards. If a zero reward is
   * applied it could affect the state tree with a &quot;empty&quot; account.
   *
   * @return If we skip block rewards when the reward is zero.
   */
  public boolean isSkipZeroBlockRewards() {
<span class="fc" id="L309">    return skipZeroBlockRewards;</span>
  }

  public MiningBeneficiaryCalculator getMiningBeneficiaryCalculator() {
<span class="fc" id="L313">    return miningBeneficiaryCalculator;</span>
  }

  public PrecompileContractRegistry getPrecompileContractRegistry() {
<span class="fc" id="L317">    return precompileContractRegistry;</span>
  }

  public PrivateTransactionProcessor getPrivateTransactionProcessor() {
<span class="nc" id="L321">    return privateTransactionProcessor;</span>
  }

  /**
   * Returns the gasCalculator used in this specification.
   *
   * @return the gas calculator
   */
  public GasCalculator getGasCalculator() {
<span class="fc" id="L330">    return gasCalculator;</span>
  }

  /**
   * Returns the gasLimitCalculator used in this specification.
   *
   * @return the gas limit calculator
   */
  public GasLimitCalculator getGasLimitCalculator() {
<span class="fc" id="L339">    return gasLimitCalculator;</span>
  }

  /**
   * Returns the Fee Market used in this specification.
   *
   * @return the {@link FeeMarket} implementation.
   */
  public FeeMarket getFeeMarket() {
<span class="fc" id="L348">    return feeMarket;</span>
  }

  /**
   * Returns the Proof-of-Work hasher
   *
   * @return the Proof-of-Work hasher
   */
  public Optional&lt;PoWHasher&gt; getPoWHasher() {
<span class="fc" id="L357">    return powHasher;</span>
  }

  public WithdrawalsValidator getWithdrawalsValidator() {
<span class="fc" id="L361">    return withdrawalsValidator;</span>
  }

  public Optional&lt;WithdrawalsProcessor&gt; getWithdrawalsProcessor() {
<span class="fc" id="L365">    return withdrawalsProcessor;</span>
  }

  public DepositsValidator getDepositsValidator() {
<span class="fc" id="L369">    return depositsValidator;</span>
  }

  /**
   * Returns true if the network is running Proof of Stake
   *
   * @return true if the network is running Proof of Stake
   */
  public boolean isPoS() {
<span class="fc" id="L378">    return isPoS;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>