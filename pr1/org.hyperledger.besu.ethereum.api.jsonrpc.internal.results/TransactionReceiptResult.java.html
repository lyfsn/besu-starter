<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TransactionReceiptResult.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">besu</a> &gt; <a href="index.source.html" class="el_package">org.hyperledger.besu.ethereum.api.jsonrpc.internal.results</a> &gt; <span class="el_source">TransactionReceiptResult.java</span></div><h1>TransactionReceiptResult.java</h1><pre class="source lang-java linenums">/*
 * Copyright ConsenSys AG.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except in compliance with
 * the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on
 * an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */
package org.hyperledger.besu.ethereum.api.jsonrpc.internal.results;

import org.hyperledger.besu.datatypes.Address;
import org.hyperledger.besu.datatypes.Hash;
import org.hyperledger.besu.datatypes.TransactionType;
import org.hyperledger.besu.ethereum.api.query.TransactionReceiptWithMetadata;
import org.hyperledger.besu.ethereum.core.Transaction;
import org.hyperledger.besu.ethereum.core.TransactionReceipt;
import org.hyperledger.besu.evm.log.Log;

import java.util.ArrayList;
import java.util.List;

import com.fasterxml.jackson.annotation.JsonGetter;
import com.fasterxml.jackson.annotation.JsonInclude;
import com.fasterxml.jackson.annotation.JsonPropertyOrder;
import org.apache.tuweni.bytes.Bytes;

@JsonPropertyOrder({
  &quot;blockHash&quot;,
  &quot;blockNumber&quot;,
  &quot;contractAddress&quot;,
  &quot;cumulativeGasUsed&quot;,
  &quot;from&quot;,
  &quot;gasUsed&quot;,
  &quot;effectiveGasPrice&quot;,
  &quot;logs&quot;,
  &quot;logsBloom&quot;,
  &quot;root&quot;,
  &quot;status&quot;,
  &quot;to&quot;,
  &quot;transactionHash&quot;,
  &quot;transactionIndex&quot;,
  &quot;revertReason&quot;,
  &quot;type&quot;,
  &quot;blobGasUsed&quot;,
  &quot;blobGasPrice&quot;
})
public abstract class TransactionReceiptResult {

  private final String blockHash;
  private final String blockNumber;
  private final String contractAddress;
  private final String cumulativeGasUsed;
  private final String from;
  private final String gasUsed;
  private final String effectiveGasPrice;
  private final List&lt;TransactionReceiptLogResult&gt; logs;
  private final String logsBloom;
  private final String to;
  private final String transactionHash;
  private final String transactionIndex;
  private final String revertReason;

  protected final TransactionReceipt receipt;
  protected final String type;

  private final String blobGasUsed;
  private final String blobGasPrice;

<span class="fc" id="L75">  protected TransactionReceiptResult(final TransactionReceiptWithMetadata receiptWithMetadata) {</span>
<span class="fc" id="L76">    final Transaction txn = receiptWithMetadata.getTransaction();</span>
<span class="fc" id="L77">    this.receipt = receiptWithMetadata.getReceipt();</span>
<span class="fc" id="L78">    this.blockHash = receiptWithMetadata.getBlockHash().toString();</span>
<span class="fc" id="L79">    this.blockNumber = Quantity.create(receiptWithMetadata.getBlockNumber());</span>
<span class="fc" id="L80">    this.contractAddress = txn.contractAddress().map(Address::toString).orElse(null);</span>
<span class="fc" id="L81">    this.cumulativeGasUsed = Quantity.create(receipt.getCumulativeGasUsed());</span>
<span class="fc" id="L82">    this.from = txn.getSender().toString();</span>
<span class="fc" id="L83">    this.gasUsed = Quantity.create(receiptWithMetadata.getGasUsed());</span>
<span class="fc" id="L84">    this.blobGasUsed = receiptWithMetadata.getBlobGasUsed().map(Quantity::create).orElse(null);</span>
<span class="fc" id="L85">    this.blobGasPrice = receiptWithMetadata.getBlobGasPrice().map(Quantity::create).orElse(null);</span>
<span class="fc" id="L86">    this.effectiveGasPrice =</span>
<span class="fc" id="L87">        Quantity.create(txn.getEffectiveGasPrice(receiptWithMetadata.getBaseFee()));</span>

<span class="fc" id="L89">    this.logs =</span>
<span class="fc" id="L90">        logReceipts(</span>
<span class="fc" id="L91">            receipt.getLogsList(),</span>
<span class="fc" id="L92">            receiptWithMetadata.getBlockNumber(),</span>
<span class="fc" id="L93">            txn.getHash(),</span>
<span class="fc" id="L94">            receiptWithMetadata.getBlockHash(),</span>
<span class="fc" id="L95">            receiptWithMetadata.getTransactionIndex(),</span>
<span class="fc" id="L96">            receiptWithMetadata.getLogIndexOffset());</span>
<span class="fc" id="L97">    this.logsBloom = receipt.getBloomFilter().toString();</span>
<span class="fc" id="L98">    this.to = txn.getTo().map(Bytes::toHexString).orElse(null);</span>
<span class="fc" id="L99">    this.transactionHash = txn.getHash().toString();</span>
<span class="fc" id="L100">    this.transactionIndex = Quantity.create(receiptWithMetadata.getTransactionIndex());</span>
<span class="fc" id="L101">    this.revertReason = receipt.getRevertReason().map(Bytes::toString).orElse(null);</span>
<span class="fc" id="L102">    this.type =</span>
<span class="fc bfc" id="L103" title="All 2 branches covered.">        txn.getType().equals(TransactionType.FRONTIER)</span>
<span class="fc" id="L104">            ? Quantity.create(0)</span>
<span class="fc" id="L105">            : Quantity.create(txn.getType().getSerializedType());</span>
<span class="fc" id="L106">  }</span>

  @JsonGetter(value = &quot;blockHash&quot;)
  public String getBlockHash() {
<span class="fc" id="L110">    return blockHash;</span>
  }

  @JsonGetter(value = &quot;blockNumber&quot;)
  public String getBlockNumber() {
<span class="fc" id="L115">    return blockNumber;</span>
  }

  @JsonGetter(value = &quot;contractAddress&quot;)
  public String getContractAddress() {
<span class="fc" id="L120">    return contractAddress;</span>
  }

  @JsonGetter(value = &quot;cumulativeGasUsed&quot;)
  public String getCumulativeGasUsed() {
<span class="fc" id="L125">    return cumulativeGasUsed;</span>
  }

  @JsonGetter(value = &quot;from&quot;)
  public String getFrom() {
<span class="fc" id="L130">    return from;</span>
  }

  @JsonGetter(value = &quot;gasUsed&quot;)
  public String getGasUsed() {
<span class="fc" id="L135">    return gasUsed;</span>
  }

  @JsonGetter(value = &quot;blobGasUsed&quot;)
  @JsonInclude(JsonInclude.Include.NON_NULL)
  public String getBlobGasUsed() {
<span class="fc" id="L141">    return blobGasUsed;</span>
  }

  @JsonGetter(value = &quot;blobGasPrice&quot;)
  @JsonInclude(JsonInclude.Include.NON_NULL)
  public String getBlobGasPrice() {
<span class="fc" id="L147">    return blobGasPrice;</span>
  }

  @JsonGetter(value = &quot;effectiveGasPrice&quot;)
  public String getEffectiveGasPrice() {
<span class="fc" id="L152">    return effectiveGasPrice;</span>
  }

  @JsonGetter(value = &quot;logs&quot;)
  public List&lt;TransactionReceiptLogResult&gt; getLogs() {
<span class="fc" id="L157">    return logs;</span>
  }

  @JsonGetter(value = &quot;logsBloom&quot;)
  public String getLogsBloom() {
<span class="fc" id="L162">    return logsBloom;</span>
  }

  @JsonGetter(value = &quot;to&quot;)
  public String getTo() {
<span class="fc" id="L167">    return to;</span>
  }

  @JsonGetter(value = &quot;transactionHash&quot;)
  public String getTransactionHash() {
<span class="fc" id="L172">    return transactionHash;</span>
  }

  @JsonGetter(value = &quot;transactionIndex&quot;)
  public String getTransactionIndex() {
<span class="fc" id="L177">    return transactionIndex;</span>
  }

  @JsonGetter(value = &quot;type&quot;)
  public String getType() {
<span class="fc" id="L182">    return type;</span>
  }

  @JsonInclude(JsonInclude.Include.NON_NULL)
  @JsonGetter(value = &quot;revertReason&quot;)
  public String getRevertReason() {
<span class="fc" id="L188">    return revertReason;</span>
  }

  private List&lt;TransactionReceiptLogResult&gt; logReceipts(
      final List&lt;Log&gt; logs,
      final long blockNumber,
      final Hash transactionHash,
      final Hash blockHash,
      final int transactionIndex,
      final int logIndexOffset) {
<span class="fc" id="L198">    final List&lt;TransactionReceiptLogResult&gt; logResults = new ArrayList&lt;&gt;(logs.size());</span>

<span class="fc bfc" id="L200" title="All 2 branches covered.">    for (int i = 0; i &lt; logs.size(); i++) {</span>
<span class="fc" id="L201">      final Log log = logs.get(i);</span>
<span class="fc" id="L202">      logResults.add(</span>
          new TransactionReceiptLogResult(
              log, blockNumber, transactionHash, blockHash, transactionIndex, i + logIndexOffset));
    }

<span class="fc" id="L207">    return logResults;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>