<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>EVMExecutor.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">besu</a> &gt; <a href="index.source.html" class="el_package">org.hyperledger.besu.evm.fluent</a> &gt; <span class="el_source">EVMExecutor.java</span></div><h1>EVMExecutor.java</h1><pre class="source lang-java linenums">/*
 * Copyright contributors to Hyperledger Besu
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except in compliance with
 * the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on
 * an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */
package org.hyperledger.besu.evm.fluent;

import static com.google.common.base.Preconditions.checkNotNull;

import org.hyperledger.besu.collections.trie.BytesTrieSet;
import org.hyperledger.besu.datatypes.Address;
import org.hyperledger.besu.datatypes.Hash;
import org.hyperledger.besu.datatypes.VersionedHash;
import org.hyperledger.besu.datatypes.Wei;
import org.hyperledger.besu.evm.Code;
import org.hyperledger.besu.evm.EVM;
import org.hyperledger.besu.evm.EvmSpecVersion;
import org.hyperledger.besu.evm.MainnetEVMs;
import org.hyperledger.besu.evm.code.CodeV0;
import org.hyperledger.besu.evm.contractvalidation.ContractValidationRule;
import org.hyperledger.besu.evm.contractvalidation.MaxCodeSizeRule;
import org.hyperledger.besu.evm.contractvalidation.PrefixCodeRule;
import org.hyperledger.besu.evm.frame.BlockValues;
import org.hyperledger.besu.evm.frame.MessageFrame;
import org.hyperledger.besu.evm.internal.EvmConfiguration;
import org.hyperledger.besu.evm.precompile.MainnetPrecompiledContracts;
import org.hyperledger.besu.evm.precompile.PrecompileContractRegistry;
import org.hyperledger.besu.evm.processor.ContractCreationProcessor;
import org.hyperledger.besu.evm.processor.MessageCallProcessor;
import org.hyperledger.besu.evm.tracing.OperationTracer;
import org.hyperledger.besu.evm.worldstate.WorldUpdater;

import java.math.BigInteger;
import java.util.Collection;
import java.util.Deque;
import java.util.List;
import java.util.Objects;
import java.util.Optional;
import java.util.Set;
import java.util.function.Function;

import com.google.common.collect.HashMultimap;
import com.google.common.collect.Multimap;
import com.google.errorprone.annotations.InlineMe;
import org.apache.tuweni.bytes.Bytes;
import org.apache.tuweni.bytes.Bytes32;

/** The Evm executor. */
public class EVMExecutor {

  private final EVM evm;
  private PrecompileContractRegistry precompileContractRegistry;
<span class="fc" id="L62">  private boolean commitWorldState = false;</span>
<span class="fc" id="L63">  private WorldUpdater worldUpdater = new SimpleWorld();</span>
<span class="fc" id="L64">  private long gas = Long.MAX_VALUE;</span>
<span class="fc" id="L65">  private Address receiver = Address.ZERO;</span>
<span class="fc" id="L66">  private Address sender = Address.ZERO;</span>
<span class="fc" id="L67">  private Address contract = Address.ZERO;</span>
<span class="fc" id="L68">  private Address coinbase = Address.ZERO;</span>
<span class="fc" id="L69">  private Wei gasPriceGWei = Wei.ZERO;</span>
<span class="fc" id="L70">  private Wei blobGasPrice = Wei.ZERO;</span>
<span class="fc" id="L71">  private Bytes callData = Bytes.EMPTY;</span>
<span class="fc" id="L72">  private Wei ethValue = Wei.ZERO;</span>
<span class="fc" id="L73">  private Code code = CodeV0.EMPTY_CODE;</span>
<span class="fc" id="L74">  private BlockValues blockValues = new SimpleBlockValues();</span>
<span class="pc" id="L75">  private Function&lt;Long, Hash&gt; blockHashLookup = h -&gt; null;</span>
<span class="fc" id="L76">  private Optional&lt;List&lt;VersionedHash&gt;&gt; versionedHashes = Optional.empty();</span>
<span class="fc" id="L77">  private OperationTracer tracer = OperationTracer.NO_TRACING;</span>
<span class="fc" id="L78">  private boolean requireDeposit = true;</span>
<span class="fc" id="L79">  private List&lt;ContractValidationRule&gt; contractValidationRules =</span>
<span class="fc" id="L80">      List.of(MaxCodeSizeRule.of(0x6000), PrefixCodeRule.of());</span>
<span class="fc" id="L81">  private long initialNonce = 1;</span>
<span class="fc" id="L82">  private Collection&lt;Address&gt; forceCommitAddresses = List.of(Address.fromHexString(&quot;0x03&quot;));</span>
<span class="fc" id="L83">  private Set&lt;Address&gt; accessListWarmAddresses = new BytesTrieSet&lt;&gt;(Address.SIZE);</span>
<span class="fc" id="L84">  private Multimap&lt;Address, Bytes32&gt; accessListWarmStorage = HashMultimap.create();</span>
<span class="fc" id="L85">  private MessageCallProcessor messageCallProcessor = null;</span>
<span class="fc" id="L86">  private ContractCreationProcessor contractCreationProcessor = null;</span>
<span class="fc" id="L87">  private MessageFrame.Type messageFrameType = MessageFrame.Type.MESSAGE_CALL;</span>

<span class="fc" id="L89">  private EVMExecutor(final EVM evm) {</span>
<span class="fc" id="L90">    checkNotNull(evm, &quot;evm must not be null&quot;);</span>
<span class="fc" id="L91">    this.evm = evm;</span>
<span class="fc" id="L92">  }</span>

  /**
   * Create an EVM with the most current activated fork on chain ID 1.
   *
   * &lt;p&gt;Note, this will change across versions
   *
   * @return executor builder
   */
  public static EVMExecutor evm() {
<span class="fc" id="L102">    return evm(EvmSpecVersion.mostRecent());</span>
  }

  /**
   * Create an EVM at the specified version with chain ID 1.
   *
   * @param fork the EVM spec version to use
   * @return executor builder
   */
  public static EVMExecutor evm(final EvmSpecVersion fork) {
<span class="fc" id="L112">    return evm(fork, BigInteger.ONE);</span>
  }

  /**
   * Create an EVM at the specified version and chain ID
   *
   * @param fork the EVM spec version to use
   * @param chainId the chain ID to use
   * @return executor builder
   */
  public static EVMExecutor evm(final EvmSpecVersion fork, final BigInteger chainId) {
<span class="fc" id="L123">    return evm(fork, chainId, EvmConfiguration.DEFAULT);</span>
  }

  /**
   * Create an EVM at the specified version and chain ID
   *
   * @param fork the EVM spec version to use
   * @param chainId the chain ID to use
   * @return executor builder
   */
  public static EVMExecutor evm(final EvmSpecVersion fork, final Bytes chainId) {
<span class="fc" id="L134">    return evm(fork, new BigInteger(1, chainId.toArrayUnsafe()), EvmConfiguration.DEFAULT);</span>
  }

  /**
   * Create an EVM at the specified version and chain ID
   *
   * @param fork the EVM spec version to use
   * @param chainId the chain ID to use
   * @param evmConfiguration system configuration options.
   * @return executor builder
   */
  public static EVMExecutor evm(
      final EvmSpecVersion fork,
      final BigInteger chainId,
      final EvmConfiguration evmConfiguration) {
<span class="pc bpc" id="L149" title="1 of 19 branches missed.">    return switch (fork) {</span>
<span class="fc" id="L150">      case FRONTIER -&gt; frontier(evmConfiguration);</span>
<span class="fc" id="L151">      case HOMESTEAD -&gt; homestead(evmConfiguration);</span>
<span class="fc" id="L152">      case TANGERINE_WHISTLE -&gt; tangerineWhistle(evmConfiguration);</span>
<span class="fc" id="L153">      case SPURIOUS_DRAGON -&gt; spuriousDragon(evmConfiguration);</span>
<span class="fc" id="L154">      case BYZANTIUM -&gt; byzantium(evmConfiguration);</span>
<span class="fc" id="L155">      case CONSTANTINOPLE -&gt; constantinople(evmConfiguration);</span>
<span class="fc" id="L156">      case PETERSBURG -&gt; petersburg(evmConfiguration);</span>
<span class="fc" id="L157">      case ISTANBUL -&gt; istanbul(chainId, evmConfiguration);</span>
<span class="fc" id="L158">      case BERLIN -&gt; berlin(chainId, evmConfiguration);</span>
<span class="fc" id="L159">      case LONDON -&gt; london(chainId, evmConfiguration);</span>
<span class="fc" id="L160">      case PARIS -&gt; paris(chainId, evmConfiguration);</span>
<span class="fc" id="L161">      case SHANGHAI -&gt; shanghai(chainId, evmConfiguration);</span>
<span class="fc" id="L162">      case CANCUN -&gt; cancun(chainId, evmConfiguration);</span>
<span class="fc" id="L163">      case PRAGUE -&gt; prague(chainId, evmConfiguration);</span>
<span class="fc" id="L164">      case OSAKA -&gt; osaka(chainId, evmConfiguration);</span>
<span class="fc" id="L165">      case BOGOTA -&gt; bogota(chainId, evmConfiguration);</span>
<span class="fc" id="L166">      case FUTURE_EIPS -&gt; futureEips(chainId, evmConfiguration);</span>
<span class="fc" id="L167">      case EXPERIMENTAL_EIPS -&gt; experimentalEips(chainId, evmConfiguration);</span>
    };
  }

  /**
   * Instantiate Evm executor.
   *
   * @param evm the evm
   * @return the evm executor
   */
  public static EVMExecutor evm(final EVM evm) {
<span class="fc" id="L178">    return new EVMExecutor(evm);</span>
  }

  /**
   * Instantiate Frontier evm executor.
   *
   * @param evmConfiguration the evm configuration
   * @return the evm executor
   */
  public static EVMExecutor frontier(final EvmConfiguration evmConfiguration) {
<span class="fc" id="L188">    final EVMExecutor executor = new EVMExecutor(MainnetEVMs.frontier(evmConfiguration));</span>
<span class="fc" id="L189">    executor.precompileContractRegistry =</span>
<span class="fc" id="L190">        MainnetPrecompiledContracts.frontier(executor.evm.getGasCalculator());</span>
<span class="fc" id="L191">    executor.contractValidationRules = List.of();</span>
<span class="fc" id="L192">    executor.requireDeposit = false;</span>
<span class="fc" id="L193">    executor.forceCommitAddresses = List.of();</span>
<span class="fc" id="L194">    executor.initialNonce = 0;</span>
<span class="fc" id="L195">    return executor;</span>
  }

  /**
   * Instantiate Homestead evm executor.
   *
   * @param evmConfiguration the evm configuration
   * @return the evm executor
   */
  public static EVMExecutor homestead(final EvmConfiguration evmConfiguration) {
<span class="fc" id="L205">    final EVMExecutor executor = new EVMExecutor(MainnetEVMs.homestead(evmConfiguration));</span>
<span class="fc" id="L206">    executor.precompileContractRegistry =</span>
<span class="fc" id="L207">        MainnetPrecompiledContracts.frontier(executor.evm.getGasCalculator());</span>
<span class="fc" id="L208">    executor.contractValidationRules = List.of();</span>
<span class="fc" id="L209">    executor.forceCommitAddresses = List.of();</span>
<span class="fc" id="L210">    executor.initialNonce = 0;</span>
<span class="fc" id="L211">    return executor;</span>
  }

  /**
   * Instantiate Tangerine whistle evm executor.
   *
   * @param evmConfiguration the evm configuration
   * @return the evm executor
   */
  public static EVMExecutor tangerineWhistle(final EvmConfiguration evmConfiguration) {
<span class="fc" id="L221">    final EVMExecutor executor = new EVMExecutor(MainnetEVMs.tangerineWhistle(evmConfiguration));</span>
<span class="fc" id="L222">    executor.precompileContractRegistry =</span>
<span class="fc" id="L223">        MainnetPrecompiledContracts.frontier(executor.evm.getGasCalculator());</span>
<span class="fc" id="L224">    executor.contractValidationRules = List.of();</span>
<span class="fc" id="L225">    executor.initialNonce = 0;</span>
<span class="fc" id="L226">    return executor;</span>
  }

  /**
   * Instantiate Spurious dragon evm executor.
   *
   * @param evmConfiguration the evm configuration
   * @return the evm executor
   */
  public static EVMExecutor spuriousDragon(final EvmConfiguration evmConfiguration) {
<span class="fc" id="L236">    final EVMExecutor executor = new EVMExecutor(MainnetEVMs.spuriousDragon(evmConfiguration));</span>
<span class="fc" id="L237">    executor.precompileContractRegistry =</span>
<span class="fc" id="L238">        MainnetPrecompiledContracts.frontier(executor.evm.getGasCalculator());</span>
<span class="fc" id="L239">    executor.contractValidationRules = List.of(MaxCodeSizeRule.of(0x6000));</span>
<span class="fc" id="L240">    return executor;</span>
  }

  /**
   * Instantiate Byzantium evm executor.
   *
   * @param evmConfiguration the evm configuration
   * @return the evm executor
   */
  public static EVMExecutor byzantium(final EvmConfiguration evmConfiguration) {
<span class="fc" id="L250">    final EVMExecutor executor = new EVMExecutor(MainnetEVMs.byzantium(evmConfiguration));</span>
<span class="fc" id="L251">    executor.precompileContractRegistry =</span>
<span class="fc" id="L252">        MainnetPrecompiledContracts.byzantium(executor.evm.getGasCalculator());</span>
<span class="fc" id="L253">    executor.contractValidationRules = List.of(MaxCodeSizeRule.of(0x6000));</span>
<span class="fc" id="L254">    return executor;</span>
  }

  /**
   * Instantiate Constantinople evm executor.
   *
   * @param evmConfiguration the evm configuration
   * @return the evm executor
   */
  public static EVMExecutor constantinople(final EvmConfiguration evmConfiguration) {
<span class="fc" id="L264">    final EVMExecutor executor = new EVMExecutor(MainnetEVMs.constantinople(evmConfiguration));</span>
<span class="fc" id="L265">    executor.precompileContractRegistry =</span>
<span class="fc" id="L266">        MainnetPrecompiledContracts.byzantium(executor.evm.getGasCalculator());</span>
<span class="fc" id="L267">    executor.contractValidationRules = List.of(MaxCodeSizeRule.of(0x6000));</span>
<span class="fc" id="L268">    return executor;</span>
  }

  /**
   * Instantiate Petersburg evm executor.
   *
   * @param evmConfiguration the evm configuration
   * @return the evm executor
   */
  public static EVMExecutor petersburg(final EvmConfiguration evmConfiguration) {
<span class="fc" id="L278">    final EVMExecutor executor = new EVMExecutor(MainnetEVMs.petersburg(evmConfiguration));</span>
<span class="fc" id="L279">    executor.precompileContractRegistry =</span>
<span class="fc" id="L280">        MainnetPrecompiledContracts.byzantium(executor.evm.getGasCalculator());</span>
<span class="fc" id="L281">    executor.contractValidationRules = List.of(MaxCodeSizeRule.of(0x6000));</span>
<span class="fc" id="L282">    return executor;</span>
  }

  /**
   * Instantiate Istanbul evm executor.
   *
   * @param evmConfiguration the evm configuration
   * @return the evm executor
   * @deprecated Migrate to use {@link EVMExecutor#evm(EvmSpecVersion)}.
   */
  @InlineMe(
      replacement = &quot;EVMExecutor.evm(EvmSpecVersion.ISTANBUL, BigInteger.ONE, evmConfiguration)&quot;,
      imports = {
        &quot;java.math.BigInteger&quot;,
        &quot;org.hyperledger.besu.evm.EvmSpecVersion&quot;,
        &quot;org.hyperledger.besu.evm.fluent.EVMExecutor&quot;
      })
  @Deprecated(forRemoval = true)
  public static EVMExecutor istanbul(final EvmConfiguration evmConfiguration) {
<span class="fc" id="L301">    return evm(EvmSpecVersion.ISTANBUL, BigInteger.ONE, evmConfiguration);</span>
  }

  /**
   * Instantiate Istanbul evm executor.
   *
   * @param chainId the chain ID
   * @param evmConfiguration the evm configuration
   * @return the evm executor
   */
  public static EVMExecutor istanbul(
      final BigInteger chainId, final EvmConfiguration evmConfiguration) {
<span class="fc" id="L313">    final EVMExecutor executor = new EVMExecutor(MainnetEVMs.istanbul(chainId, evmConfiguration));</span>
<span class="fc" id="L314">    executor.precompileContractRegistry =</span>
<span class="fc" id="L315">        MainnetPrecompiledContracts.istanbul(executor.evm.getGasCalculator());</span>
<span class="fc" id="L316">    executor.contractValidationRules = List.of(MaxCodeSizeRule.of(0x6000));</span>
<span class="fc" id="L317">    return executor;</span>
  }

  /**
   * Instantiate Berlin evm executor.
   *
   * @param evmConfiguration the evm configuration
   * @return the evm executor
   * @deprecated Migrate to use {@link EVMExecutor#evm(EvmSpecVersion)}.
   */
  @InlineMe(
      replacement = &quot;EVMExecutor.evm(EvmSpecVersion.BERLIN, BigInteger.ONE, evmConfiguration)&quot;,
      imports = {
        &quot;java.math.BigInteger&quot;,
        &quot;org.hyperledger.besu.evm.EvmSpecVersion&quot;,
        &quot;org.hyperledger.besu.evm.fluent.EVMExecutor&quot;
      })
  @Deprecated(forRemoval = true)
  public static EVMExecutor berlin(final EvmConfiguration evmConfiguration) {
<span class="fc" id="L336">    return evm(EvmSpecVersion.BERLIN, BigInteger.ONE, evmConfiguration);</span>
  }

  /**
   * Instantiate berlin evm executor.
   *
   * @param chainId the chain ID
   * @param evmConfiguration the evm configuration
   * @return the evm executor
   */
  public static EVMExecutor berlin(
      final BigInteger chainId, final EvmConfiguration evmConfiguration) {
<span class="fc" id="L348">    final EVMExecutor executor = new EVMExecutor(MainnetEVMs.berlin(chainId, evmConfiguration));</span>
<span class="fc" id="L349">    executor.precompileContractRegistry =</span>
<span class="fc" id="L350">        MainnetPrecompiledContracts.istanbul(executor.evm.getGasCalculator());</span>
<span class="fc" id="L351">    executor.contractValidationRules = List.of(MaxCodeSizeRule.of(0x6000));</span>
<span class="fc" id="L352">    return executor;</span>
  }

  /**
   * Instantiate London evm executor.
   *
   * @param evmConfiguration the evm configuration
   * @return the evm executor
   * @deprecated Migrate to use {@link EVMExecutor#evm(EvmSpecVersion)}.
   */
  @InlineMe(
      replacement = &quot;EVMExecutor.evm(EvmSpecVersion.LONDON, BigInteger.ONE, evmConfiguration)&quot;,
      imports = {
        &quot;java.math.BigInteger&quot;,
        &quot;org.hyperledger.besu.evm.EvmSpecVersion&quot;,
        &quot;org.hyperledger.besu.evm.fluent.EVMExecutor&quot;
      })
  @Deprecated(forRemoval = true)
  public static EVMExecutor london(final EvmConfiguration evmConfiguration) {
<span class="fc" id="L371">    return evm(EvmSpecVersion.LONDON, BigInteger.ONE, evmConfiguration);</span>
  }

  /**
   * Instantiate London evm executor.
   *
   * @param chainId the chain ID
   * @param evmConfiguration the evm configuration
   * @return the evm executor
   */
  public static EVMExecutor london(
      final BigInteger chainId, final EvmConfiguration evmConfiguration) {
<span class="fc" id="L383">    final EVMExecutor executor = new EVMExecutor(MainnetEVMs.london(chainId, evmConfiguration));</span>
<span class="fc" id="L384">    executor.precompileContractRegistry =</span>
<span class="fc" id="L385">        MainnetPrecompiledContracts.istanbul(executor.evm.getGasCalculator());</span>
<span class="fc" id="L386">    return executor;</span>
  }

  /**
   * Instantiate Paris evm executor.
   *
   * @param evmConfiguration the evm configuration
   * @return the evm executor
   * @deprecated Migrate to use {@link EVMExecutor#evm(EvmSpecVersion)}.
   */
  @InlineMe(
      replacement = &quot;EVMExecutor.evm(EvmSpecVersion.PARIS, BigInteger.ONE, evmConfiguration)&quot;,
      imports = {
        &quot;java.math.BigInteger&quot;,
        &quot;org.hyperledger.besu.evm.EvmSpecVersion&quot;,
        &quot;org.hyperledger.besu.evm.fluent.EVMExecutor&quot;
      })
  @Deprecated(forRemoval = true)
  public static EVMExecutor paris(final EvmConfiguration evmConfiguration) {
<span class="fc" id="L405">    return evm(EvmSpecVersion.PARIS, BigInteger.ONE, evmConfiguration);</span>
  }

  /**
   * Instantiate Paris evm executor.
   *
   * @param chainId the chain ID
   * @param evmConfiguration the evm configuration
   * @return the evm executor
   */
  public static EVMExecutor paris(
      final BigInteger chainId, final EvmConfiguration evmConfiguration) {
<span class="fc" id="L417">    final EVMExecutor executor = new EVMExecutor(MainnetEVMs.paris(chainId, evmConfiguration));</span>
<span class="fc" id="L418">    executor.precompileContractRegistry =</span>
<span class="fc" id="L419">        MainnetPrecompiledContracts.istanbul(executor.evm.getGasCalculator());</span>
<span class="fc" id="L420">    return executor;</span>
  }

  /**
   * Instantiate Shanghai evm executor.
   *
   * @param evmConfiguration the evm configuration
   * @return the evm executor
   * @deprecated Migrate to use {@link EVMExecutor#evm(EvmSpecVersion)}.
   */
  @InlineMe(
      replacement = &quot;EVMExecutor.evm(EvmSpecVersion.SHANGHAI, BigInteger.ONE, evmConfiguration)&quot;,
      imports = {
        &quot;java.math.BigInteger&quot;,
        &quot;org.hyperledger.besu.evm.EvmSpecVersion&quot;,
        &quot;org.hyperledger.besu.evm.fluent.EVMExecutor&quot;
      })
  @Deprecated(forRemoval = true)
  public static EVMExecutor shanghai(final EvmConfiguration evmConfiguration) {
<span class="fc" id="L439">    return evm(EvmSpecVersion.SHANGHAI, BigInteger.ONE, evmConfiguration);</span>
  }

  /**
   * Instantiate Shanghai evm executor.
   *
   * @param chainId the chain ID
   * @param evmConfiguration the evm configuration
   * @return the evm executor
   */
  public static EVMExecutor shanghai(
      final BigInteger chainId, final EvmConfiguration evmConfiguration) {
<span class="fc" id="L451">    final EVMExecutor executor = new EVMExecutor(MainnetEVMs.shanghai(chainId, evmConfiguration));</span>
<span class="fc" id="L452">    executor.precompileContractRegistry =</span>
<span class="fc" id="L453">        MainnetPrecompiledContracts.istanbul(executor.evm.getGasCalculator());</span>
<span class="fc" id="L454">    return executor;</span>
  }

  /**
   * Instantiate Cancun evm executor.
   *
   * @param evmConfiguration the evm configuration
   * @return the evm executor
   * @deprecated Migrate to use {@link EVMExecutor#evm(EvmSpecVersion)}.
   */
  @InlineMe(
      replacement = &quot;EVMExecutor.evm(EvmSpecVersion.CANCUN, BigInteger.ONE, evmConfiguration)&quot;,
      imports = {
        &quot;java.math.BigInteger&quot;,
        &quot;org.hyperledger.besu.evm.EvmSpecVersion&quot;,
        &quot;org.hyperledger.besu.evm.fluent.EVMExecutor&quot;
      })
  @Deprecated(forRemoval = true)
  public static EVMExecutor cancun(final EvmConfiguration evmConfiguration) {
<span class="fc" id="L473">    return evm(EvmSpecVersion.CANCUN, BigInteger.ONE, evmConfiguration);</span>
  }

  /**
   * Instantiate Cancun evm executor.
   *
   * @param chainId the chain ID
   * @param evmConfiguration the evm configuration
   * @return the evm executor
   */
  public static EVMExecutor cancun(
      final BigInteger chainId, final EvmConfiguration evmConfiguration) {
<span class="fc" id="L485">    final EVMExecutor executor = new EVMExecutor(MainnetEVMs.cancun(chainId, evmConfiguration));</span>
<span class="fc" id="L486">    executor.precompileContractRegistry =</span>
<span class="fc" id="L487">        MainnetPrecompiledContracts.cancun(executor.evm.getGasCalculator());</span>
<span class="fc" id="L488">    return executor;</span>
  }

  /**
   * Instantiate Prague evm executor.
   *
   * @param chainId the chain ID
   * @param evmConfiguration the evm configuration
   * @return the evm executor
   */
  public static EVMExecutor prague(
      final BigInteger chainId, final EvmConfiguration evmConfiguration) {
<span class="fc" id="L500">    final EVMExecutor executor = new EVMExecutor(MainnetEVMs.prague(chainId, evmConfiguration));</span>
<span class="fc" id="L501">    executor.precompileContractRegistry =</span>
<span class="fc" id="L502">        MainnetPrecompiledContracts.prague(executor.evm.getGasCalculator());</span>
<span class="fc" id="L503">    return executor;</span>
  }

  /**
   * Instantiate Osaka evm executor.
   *
   * @param chainId the chain ID
   * @param evmConfiguration the evm configuration
   * @return the evm executor
   */
  public static EVMExecutor osaka(
      final BigInteger chainId, final EvmConfiguration evmConfiguration) {
<span class="fc" id="L515">    final EVMExecutor executor = new EVMExecutor(MainnetEVMs.osaka(chainId, evmConfiguration));</span>
<span class="fc" id="L516">    executor.precompileContractRegistry =</span>
<span class="fc" id="L517">        MainnetPrecompiledContracts.prague(executor.evm.getGasCalculator());</span>
<span class="fc" id="L518">    return executor;</span>
  }

  /**
   * Instantiate Bogota evm executor.
   *
   * @param chainId the chain ID
   * @param evmConfiguration the evm configuration
   * @return the evm executor
   */
  public static EVMExecutor bogota(
      final BigInteger chainId, final EvmConfiguration evmConfiguration) {
<span class="fc" id="L530">    final EVMExecutor executor = new EVMExecutor(MainnetEVMs.bogota(chainId, evmConfiguration));</span>
<span class="fc" id="L531">    executor.precompileContractRegistry =</span>
<span class="fc" id="L532">        MainnetPrecompiledContracts.prague(executor.evm.getGasCalculator());</span>
<span class="fc" id="L533">    return executor;</span>
  }

  /**
   * Instantiate Future EIPs evm executor.
   *
   * @param evmConfiguration the evm configuration
   * @return the evm executor
   * @deprecated Migrate to use {@link EVMExecutor#evm(EvmSpecVersion)}.
   */
  @InlineMe(
      replacement = &quot;EVMExecutor.evm(EvmSpecVersion.FUTURE_EIPS, BigInteger.ONE, evmConfiguration)&quot;,
      imports = {
        &quot;java.math.BigInteger&quot;,
        &quot;org.hyperledger.besu.evm.EvmSpecVersion&quot;,
        &quot;org.hyperledger.besu.evm.fluent.EVMExecutor&quot;
      })
  @Deprecated(forRemoval = true)
  public static EVMExecutor futureEips(final EvmConfiguration evmConfiguration) {
<span class="fc" id="L552">    return evm(EvmSpecVersion.FUTURE_EIPS, BigInteger.ONE, evmConfiguration);</span>
  }

  /**
   * Instantiate Future EIPs evm executor.
   *
   * @param chainId the chain ID
   * @param evmConfiguration the evm configuration
   * @return the evm executor
   */
  public static EVMExecutor futureEips(
      final BigInteger chainId, final EvmConfiguration evmConfiguration) {
<span class="fc" id="L564">    final EVMExecutor executor = new EVMExecutor(MainnetEVMs.futureEips(chainId, evmConfiguration));</span>
<span class="fc" id="L565">    executor.precompileContractRegistry =</span>
<span class="fc" id="L566">        MainnetPrecompiledContracts.futureEIPs(executor.evm.getGasCalculator());</span>
<span class="fc" id="L567">    return executor;</span>
  }

  /**
   * Instantiate Experimental EIPs evm executor.
   *
   * @param chainId the chain ID
   * @param evmConfiguration the evm configuration
   * @return the evm executor
   */
  public static EVMExecutor experimentalEips(
      final BigInteger chainId, final EvmConfiguration evmConfiguration) {
<span class="fc" id="L579">    final EVMExecutor executor =</span>
<span class="fc" id="L580">        new EVMExecutor(MainnetEVMs.experimentalEips(chainId, evmConfiguration));</span>
<span class="fc" id="L581">    executor.precompileContractRegistry =</span>
<span class="fc" id="L582">        MainnetPrecompiledContracts.futureEIPs(executor.evm.getGasCalculator());</span>
<span class="fc" id="L583">    return executor;</span>
  }

  private MessageCallProcessor thisMessageCallProcessor() {
<span class="fc" id="L587">    return Objects.requireNonNullElseGet(</span>
<span class="fc" id="L588">        messageCallProcessor, () -&gt; new MessageCallProcessor(evm, precompileContractRegistry));</span>
  }

  private ContractCreationProcessor thisContractCreationProcessor() {
<span class="fc" id="L592">    return Objects.requireNonNullElseGet(</span>
        contractCreationProcessor,
        () -&gt;
<span class="fc" id="L595">            new ContractCreationProcessor(</span>
<span class="fc" id="L596">                evm.getGasCalculator(),</span>
                evm,
                requireDeposit,
                contractValidationRules,
                initialNonce,
                forceCommitAddresses));
  }

  /**
   * Execute code.
   *
   * @param code the code
   * @param inputData the input data
   * @param value the value
   * @param receiver the receiver
   * @return the bytes
   */
  public Bytes execute(
      final Code code, final Bytes inputData, final Wei value, final Address receiver) {
<span class="fc" id="L615">    this.code = code;</span>
<span class="fc" id="L616">    this.callData = inputData;</span>
<span class="fc" id="L617">    this.ethValue = value;</span>
<span class="fc" id="L618">    this.receiver = receiver;</span>
<span class="fc" id="L619">    return execute();</span>
  }

  /**
   * Execute code.
   *
   * @param codeBytes the code bytes
   * @param inputData the input data
   * @param value the value
   * @param receiver the receiver
   * @return the bytes
   */
  public Bytes execute(
      final Bytes codeBytes, final Bytes inputData, final Wei value, final Address receiver) {
<span class="fc" id="L633">    this.code = evm.getCode(Hash.hash(codeBytes), codeBytes);</span>
<span class="fc" id="L634">    this.callData = inputData;</span>
<span class="fc" id="L635">    this.ethValue = value;</span>
<span class="fc" id="L636">    this.receiver = receiver;</span>
<span class="fc" id="L637">    return execute();</span>
  }

  /**
   * Execute.
   *
   * @return the bytes
   */
  public Bytes execute() {
<span class="fc" id="L646">    final MessageCallProcessor mcp = thisMessageCallProcessor();</span>
<span class="fc" id="L647">    final ContractCreationProcessor ccp = thisContractCreationProcessor();</span>
    final MessageFrame initialMessageFrame =
<span class="fc" id="L649">        MessageFrame.builder()</span>
<span class="fc" id="L650">            .type(messageFrameType)</span>
<span class="fc" id="L651">            .worldUpdater(worldUpdater.updater())</span>
<span class="fc" id="L652">            .initialGas(gas)</span>
<span class="fc" id="L653">            .contract(contract)</span>
<span class="fc" id="L654">            .address(receiver)</span>
<span class="fc" id="L655">            .originator(sender)</span>
<span class="fc" id="L656">            .sender(sender)</span>
<span class="fc" id="L657">            .gasPrice(gasPriceGWei)</span>
<span class="fc" id="L658">            .blobGasPrice(blobGasPrice)</span>
<span class="fc" id="L659">            .inputData(callData)</span>
<span class="fc" id="L660">            .value(ethValue)</span>
<span class="fc" id="L661">            .apparentValue(ethValue)</span>
<span class="fc" id="L662">            .code(code)</span>
<span class="fc" id="L663">            .blockValues(blockValues)</span>
<span class="fc" id="L664">            .miningBeneficiary(coinbase)</span>
<span class="fc" id="L665">            .blockHashLookup(blockHashLookup)</span>
<span class="fc" id="L666">            .accessListWarmAddresses(accessListWarmAddresses)</span>
<span class="fc" id="L667">            .accessListWarmStorage(accessListWarmStorage)</span>
<span class="fc" id="L668">            .versionedHashes(versionedHashes)</span>
<span class="fc" id="L669">            .completer(c -&gt; {})</span>
<span class="fc" id="L670">            .build();</span>

<span class="fc" id="L672">    final Deque&lt;MessageFrame&gt; messageFrameStack = initialMessageFrame.getMessageFrameStack();</span>
<span class="fc bfc" id="L673" title="All 2 branches covered.">    while (!messageFrameStack.isEmpty()) {</span>
<span class="fc" id="L674">      final MessageFrame messageFrame = messageFrameStack.peek();</span>
<span class="fc bfc" id="L675" title="All 2 branches covered.">      if (messageFrame.getType() == MessageFrame.Type.CONTRACT_CREATION) {</span>
<span class="fc" id="L676">        ccp.process(messageFrame, tracer);</span>
<span class="pc bpc" id="L677" title="1 of 2 branches missed.">      } else if (messageFrame.getType() == MessageFrame.Type.MESSAGE_CALL) {</span>
<span class="fc" id="L678">        mcp.process(messageFrame, tracer);</span>
      }
<span class="fc" id="L680">    }</span>
<span class="fc bfc" id="L681" title="All 2 branches covered.">    if (commitWorldState) {</span>
<span class="fc" id="L682">      worldUpdater.commit();</span>
    }
<span class="fc" id="L684">    return initialMessageFrame.getReturnData();</span>
  }

  /**
   * MArk Commit world state to true.
   *
   * @return the evm executor
   */
  public EVMExecutor commitWorldState() {
<span class="fc" id="L693">    return commitWorldState(true);</span>
  }

  /**
   * Sets Commit world state.
   *
   * @param commitWorldState the commit world state
   * @return the evm executor
   */
  public EVMExecutor commitWorldState(final boolean commitWorldState) {
<span class="fc" id="L703">    this.commitWorldState = commitWorldState;</span>
<span class="fc" id="L704">    return this;</span>
  }

  /**
   * Sets World updater.
   *
   * @param worldUpdater the world updater
   * @return the evm executor
   */
  public EVMExecutor worldUpdater(final WorldUpdater worldUpdater) {
<span class="fc" id="L714">    this.worldUpdater = worldUpdater;</span>
<span class="fc" id="L715">    return this;</span>
  }

  /**
   * Sets Gas.
   *
   * @param gas the gas
   * @return the evm executor
   */
  public EVMExecutor gas(final long gas) {
<span class="fc" id="L725">    this.gas = gas;</span>
<span class="fc" id="L726">    return this;</span>
  }

  /**
   * Sets Receiver address.
   *
   * @param receiver the receiver
   * @return the evm executor
   */
  public EVMExecutor receiver(final Address receiver) {
<span class="fc" id="L736">    this.receiver = receiver;</span>
<span class="fc" id="L737">    return this;</span>
  }

  /**
   * Sets Sender address.
   *
   * @param sender the sender
   * @return the evm executor
   */
  public EVMExecutor sender(final Address sender) {
<span class="fc" id="L747">    this.sender = sender;</span>
<span class="fc" id="L748">    return this;</span>
  }

  /**
   * Sets the address of the executing contract
   *
   * @param contract the contract
   * @return the evm executor
   */
  public EVMExecutor contract(final Address contract) {
<span class="fc" id="L758">    this.contract = contract;</span>
<span class="fc" id="L759">    return this;</span>
  }

  /**
   * Sets the address of the coinbase aka mining beneficiary
   *
   * @param coinbase the coinbase
   * @return the evm executor
   */
  public EVMExecutor coinbase(final Address coinbase) {
<span class="fc" id="L769">    this.coinbase = coinbase;</span>
    // EIP-3651
<span class="pc bpc" id="L771" title="1 of 2 branches missed.">    if (EvmSpecVersion.SHANGHAI.compareTo(evm.getEvmVersion()) &lt;= 0) {</span>
<span class="fc" id="L772">      this.warmAddress(coinbase);</span>
    }
<span class="fc" id="L774">    return this;</span>
  }

  /**
   * Sets Gas price GWei.
   *
   * @param gasPriceGWei the gas price g wei
   * @return the evm executor
   */
  public EVMExecutor gasPriceGWei(final Wei gasPriceGWei) {
<span class="fc" id="L784">    this.gasPriceGWei = gasPriceGWei;</span>
<span class="fc" id="L785">    return this;</span>
  }

  /**
   * Sets Blob Gas price.
   *
   * @param blobGasPrice the blob gas price g wei
   * @return the evm executor
   */
  public EVMExecutor blobGasPrice(final Wei blobGasPrice) {
<span class="fc" id="L795">    this.blobGasPrice = blobGasPrice;</span>
<span class="fc" id="L796">    return this;</span>
  }

  /**
   * Sets Call data.
   *
   * @param callData the call data
   * @return the evm executor
   */
  public EVMExecutor callData(final Bytes callData) {
<span class="fc" id="L806">    this.callData = callData;</span>
<span class="fc" id="L807">    return this;</span>
  }

  /**
   * Sets Eth value.
   *
   * @param ethValue the eth value
   * @return the evm executor
   */
  public EVMExecutor ethValue(final Wei ethValue) {
<span class="fc" id="L817">    this.ethValue = ethValue;</span>
<span class="fc" id="L818">    return this;</span>
  }

  /**
   * Sets Code.
   *
   * @param code the code
   * @return the evm executor
   */
  public EVMExecutor code(final Code code) {
<span class="fc" id="L828">    this.code = code;</span>
<span class="fc" id="L829">    return this;</span>
  }

  /**
   * Sets Code.
   *
   * @param codeBytes the code bytes
   * @return the evm executor
   */
  public EVMExecutor code(final Bytes codeBytes) {
<span class="fc" id="L839">    return code(codeBytes, Hash.hash(codeBytes));</span>
  }

  /**
   * Sets Code.
   *
   * @param codeBytes the code bytes
   * @param hash the hash
   * @return the evm executor
   */
  public EVMExecutor code(final Bytes codeBytes, final Hash hash) {
<span class="fc" id="L850">    this.code = evm.getCode(hash, codeBytes);</span>
<span class="fc" id="L851">    return this;</span>
  }

  /**
   * Sets Block values.
   *
   * @param blockValues the block values
   * @return the evm executor
   */
  public EVMExecutor blockValues(final BlockValues blockValues) {
<span class="fc" id="L861">    this.blockValues = blockValues;</span>
<span class="fc" id="L862">    return this;</span>
  }

  /**
   * Sets the difficulty bytes on a SimpleBlockValues object
   *
   * @param difficulty the difficulty
   * @return the evm executor
   * @throws ClassCastException if the blockValues was set with a value that is not a {@link
   *     SimpleBlockValues}
   */
  public EVMExecutor difficulty(final Bytes difficulty) {
<span class="fc" id="L874">    ((SimpleBlockValues) this.blockValues).setDifficultyBytes(difficulty);</span>
<span class="fc" id="L875">    return this;</span>
  }

  /**
   * Sets the mix hash bytes on a SimpleBlockValues object
   *
   * @param mixHash the mix hash
   * @return the evm executor
   * @throws ClassCastException if the blockValues was set with a value that is not a {@link
   *     SimpleBlockValues}
   */
  public EVMExecutor mixHash(final Bytes32 mixHash) {
<span class="fc" id="L887">    ((SimpleBlockValues) this.blockValues).setMixHashOrPrevRandao(mixHash);</span>
<span class="fc" id="L888">    return this;</span>
  }

  /**
   * Sets the prev randao bytes on a SimpleBlockValues object
   *
   * @param prevRandao the prev randao
   * @return the evm executor
   * @throws ClassCastException if the blockValues was set with a value that is not a {@link
   *     SimpleBlockValues}
   */
  public EVMExecutor prevRandao(final Bytes32 prevRandao) {
<span class="fc" id="L900">    ((SimpleBlockValues) this.blockValues).setMixHashOrPrevRandao(prevRandao);</span>
<span class="fc" id="L901">    return this;</span>
  }

  /**
   * Sets the baseFee for the block, directly.
   *
   * @param baseFee the baseFee
   * @return the evm executor
   * @throws ClassCastException if the blockValues was set with a value that is not a {@link
   *     SimpleBlockValues}
   */
  public EVMExecutor baseFee(final Wei baseFee) {
<span class="fc" id="L913">    return baseFee(Optional.ofNullable(baseFee));</span>
  }

  /**
   * Sets the baseFee for the block, as an Optional.
   *
   * @param baseFee the baseFee
   * @return the evm executor
   * @throws ClassCastException if the blockValues was set with a value that is not a {@link
   *     SimpleBlockValues}
   */
  public EVMExecutor baseFee(final Optional&lt;Wei&gt; baseFee) {
<span class="fc" id="L925">    ((SimpleBlockValues) this.blockValues).setBaseFee(baseFee);</span>
<span class="fc" id="L926">    return this;</span>
  }

  /**
   * Sets the block number for the block.
   *
   * @param number the block number
   * @return the evm executor
   * @throws ClassCastException if the blockValues was set with a value that is not a {@link
   *     SimpleBlockValues}
   */
  public EVMExecutor number(final long number) {
<span class="fc" id="L938">    ((SimpleBlockValues) this.blockValues).setNumber(number);</span>
<span class="fc" id="L939">    return this;</span>
  }

  /**
   * Sets the timestamp for the block.
   *
   * @param timestamp the block timestamp
   * @return the evm executor
   * @throws ClassCastException if the blockValues was set with a value that is not a {@link
   *     SimpleBlockValues}
   */
  public EVMExecutor timestamp(final long timestamp) {
<span class="fc" id="L951">    ((SimpleBlockValues) this.blockValues).setTimestamp(timestamp);</span>
<span class="fc" id="L952">    return this;</span>
  }

  /**
   * Sets the gas limit for the block.
   *
   * @param gasLimit the block gas limit
   * @return the evm executor
   * @throws ClassCastException if the blockValues was set with a value that is not a {@link
   *     SimpleBlockValues}
   */
  public EVMExecutor gasLimit(final long gasLimit) {
<span class="fc" id="L964">    ((SimpleBlockValues) this.blockValues).setGasLimit(gasLimit);</span>
<span class="fc" id="L965">    return this;</span>
  }

  /**
   * Sets the block hash lookup function
   *
   * @param blockHashLookup the block hash lookup function
   * @return the evm executor
   */
  public EVMExecutor blockHashLookup(final Function&lt;Long, Hash&gt; blockHashLookup) {
<span class="fc" id="L975">    this.blockHashLookup = blockHashLookup;</span>
<span class="fc" id="L976">    return this;</span>
  }

  /**
   * Sets Version Hashes for blobs. The blobs themselves are not accessible.
   *
   * @param versionedHashes the versioned hashes
   * @return the evm executor
   */
  public EVMExecutor versionedHashes(final Optional&lt;List&lt;VersionedHash&gt;&gt; versionedHashes) {
<span class="fc" id="L986">    this.versionedHashes = versionedHashes;</span>
<span class="fc" id="L987">    return this;</span>
  }

  /**
   * Sets Operation Tracer.
   *
   * @param tracer the tracer
   * @return the evm executor
   */
  public EVMExecutor tracer(final OperationTracer tracer) {
<span class="fc" id="L997">    this.tracer = tracer;</span>
<span class="fc" id="L998">    return this;</span>
  }

  /**
   * Sets Precompile contract registry.
   *
   * @param precompileContractRegistry the precompile contract registry
   * @return the evm executor
   */
  public EVMExecutor precompileContractRegistry(
      final PrecompileContractRegistry precompileContractRegistry) {
<span class="fc" id="L1009">    this.precompileContractRegistry = precompileContractRegistry;</span>
<span class="fc" id="L1010">    return this;</span>
  }

  /**
   * Sets Require deposit.
   *
   * @param requireDeposit the require deposit
   * @return the evm executor
   */
  public EVMExecutor requireDeposit(final boolean requireDeposit) {
<span class="fc" id="L1020">    this.requireDeposit = requireDeposit;</span>
<span class="fc" id="L1021">    return this;</span>
  }

  /**
   * Sets Initial nonce.
   *
   * @param initialNonce the initial nonce
   * @return the evm executor
   */
  public EVMExecutor initialNonce(final long initialNonce) {
<span class="fc" id="L1031">    this.initialNonce = initialNonce;</span>
<span class="fc" id="L1032">    return this;</span>
  }

  /**
   * Sets Contract validation rules.
   *
   * @param contractValidationRules the contract validation rules
   * @return the evm executor
   */
  public EVMExecutor contractValidationRules(
      final List&lt;ContractValidationRule&gt; contractValidationRules) {
<span class="fc" id="L1043">    this.contractValidationRules = contractValidationRules;</span>
<span class="fc" id="L1044">    return this;</span>
  }

  /**
   * List of EIP-718 contracts that require special delete handling. By default, this is only the
   * RIPEMD precompile contract.
   *
   * @param forceCommitAddresses collection of addresses for special handling
   * @return fluent executor
   * @see &lt;a
   *     href=&quot;https://github.com/ethereum/EIPs/issues/716&quot;&gt;https://github.com/ethereum/EIPs/issues/716&lt;/a&gt;
   */
  public EVMExecutor forceCommitAddresses(final Collection&lt;Address&gt; forceCommitAddresses) {
<span class="fc" id="L1057">    this.forceCommitAddresses = forceCommitAddresses;</span>
<span class="fc" id="L1058">    return this;</span>
  }

  /**
   * Sets Access list warm addresses.
   *
   * @param accessListWarmAddresses the access list warm addresses
   * @return the evm executor
   */
  public EVMExecutor accessListWarmAddresses(final Set&lt;Address&gt; accessListWarmAddresses) {
<span class="fc" id="L1068">    this.accessListWarmAddresses = accessListWarmAddresses;</span>
<span class="fc" id="L1069">    return this;</span>
  }

  /**
   * Sets Warm addresses.
   *
   * @param addresses the addresses
   * @return the evm executor
   */
  public EVMExecutor warmAddress(final Address... addresses) {
<span class="fc" id="L1079">    this.accessListWarmAddresses.addAll(List.of(addresses));</span>
<span class="fc" id="L1080">    return this;</span>
  }

  /**
   * Sets Access list warm storage map.
   *
   * @param accessListWarmStorage the access list warm storage
   * @return the evm executor
   */
  public EVMExecutor accessListWarmStorage(final Multimap&lt;Address, Bytes32&gt; accessListWarmStorage) {
<span class="fc" id="L1090">    this.accessListWarmStorage = accessListWarmStorage;</span>
<span class="fc" id="L1091">    return this;</span>
  }

  /**
   * Sets Access list warm storage.
   *
   * @param address the address
   * @param slots the slots
   * @return the evm executor
   */
  public EVMExecutor accessListWarmStorage(final Address address, final Bytes32... slots) {
<span class="fc" id="L1102">    this.accessListWarmStorage.putAll(address, List.of(slots));</span>
<span class="fc" id="L1103">    return this;</span>
  }

  /**
   * Sets Message call processor.
   *
   * @param messageCallProcessor the message call processor
   * @return the evm executor
   */
  public EVMExecutor messageCallProcessor(final MessageCallProcessor messageCallProcessor) {
<span class="fc" id="L1113">    this.messageCallProcessor = messageCallProcessor;</span>
<span class="fc" id="L1114">    return this;</span>
  }

  /**
   * Sets Contract call processor.
   *
   * @param contractCreationProcessor the contract creation processor
   * @return the evm executor
   */
  public EVMExecutor contractCallProcessor(
      final ContractCreationProcessor contractCreationProcessor) {
<span class="fc" id="L1125">    this.contractCreationProcessor = contractCreationProcessor;</span>
<span class="fc" id="L1126">    return this;</span>
  }

  /**
   * Sets the message frame type
   *
   * @param messageFrameType message frame type
   * @return the builder
   */
  public EVMExecutor messageFrameType(final MessageFrame.Type messageFrameType) {
<span class="fc" id="L1136">    this.messageFrameType = messageFrameType;</span>
<span class="fc" id="L1137">    return this;</span>
  }

  /**
   * Returns the EVM version this executor is using
   *
   * @return the current EVM version
   */
  public EvmSpecVersion getEVMVersion() {
<span class="fc" id="L1146">    return evm.getEvmVersion();</span>
  }

  /**
   * Returns the ChaindD this executor is using
   *
   * @return the current chain ID
   */
  public Optional&lt;Bytes&gt; getChainId() {
<span class="fc" id="L1155">    return evm.getChainId();</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>