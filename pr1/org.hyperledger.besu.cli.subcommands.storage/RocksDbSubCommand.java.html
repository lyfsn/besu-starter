<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RocksDbSubCommand.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">besu</a> &gt; <a href="index.source.html" class="el_package">org.hyperledger.besu.cli.subcommands.storage</a> &gt; <span class="el_source">RocksDbSubCommand.java</span></div><h1>RocksDbSubCommand.java</h1><pre class="source lang-java linenums">/*
 * Copyright Hyperledger Besu Contributors.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except in compliance with
 * the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on
 * an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */
package org.hyperledger.besu.cli.subcommands.storage;

import static org.hyperledger.besu.controller.BesuController.DATABASE_PATH;

import org.hyperledger.besu.cli.util.VersionProvider;

import java.io.PrintWriter;
import java.util.ArrayList;
import java.util.List;

import org.rocksdb.RocksDBException;
import picocli.CommandLine;
import picocli.CommandLine.Command;
import picocli.CommandLine.ParentCommand;

/** The RocksDB subcommand. */
@Command(
    name = &quot;rocksdb&quot;,
    description = &quot;Print RocksDB information&quot;,
    mixinStandardHelpOptions = true,
    versionProvider = VersionProvider.class,
    subcommands = {RocksDbSubCommand.RocksDbUsage.class, RocksDbSubCommand.RocksDbStats.class})
<span class="fc" id="L37">public class RocksDbSubCommand implements Runnable {</span>

  @SuppressWarnings(&quot;unused&quot;)
  @ParentCommand
  private StorageSubCommand storageSubCommand;

  @SuppressWarnings(&quot;unused&quot;)
  @CommandLine.Spec
  private CommandLine.Model.CommandSpec spec;

  @Override
  public void run() {
<span class="nc" id="L49">    spec.commandLine().usage(System.out);</span>
<span class="nc" id="L50">  }</span>

  @Command(
      name = &quot;usage&quot;,
      description = &quot;Print disk usage&quot;,
      mixinStandardHelpOptions = true,
      versionProvider = VersionProvider.class)
<span class="fc" id="L57">  static class RocksDbUsage implements Runnable {</span>

    @SuppressWarnings(&quot;unused&quot;)
    @CommandLine.Spec
    private CommandLine.Model.CommandSpec spec;

    @SuppressWarnings(&quot;unused&quot;)
    @ParentCommand
    private RocksDbSubCommand rocksDbSubCommand;

    @Override
    public void run() {

<span class="nc" id="L70">      final PrintWriter out = spec.commandLine().getOut();</span>

<span class="nc" id="L72">      final String dbPath =</span>
          rocksDbSubCommand
              .storageSubCommand
              .besuCommand
<span class="nc" id="L76">              .dataDir()</span>
<span class="nc" id="L77">              .resolve(DATABASE_PATH)</span>
<span class="nc" id="L78">              .toString();</span>

<span class="nc" id="L80">      RocksDbHelper.printTableHeader(out);</span>

<span class="nc" id="L82">      final List&lt;RocksDbHelper.ColumnFamilyUsage&gt; columnFamilyUsages = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L83">      RocksDbHelper.forEachColumnFamily(</span>
          dbPath,
          (rocksdb, cfHandle) -&gt; {
            try {
<span class="nc" id="L87">              columnFamilyUsages.add(</span>
<span class="nc" id="L88">                  RocksDbHelper.getAndPrintUsageForColumnFamily(rocksdb, cfHandle, out));</span>
<span class="nc" id="L89">            } catch (RocksDBException e) {</span>
<span class="nc" id="L90">              throw new RuntimeException(e);</span>
<span class="nc" id="L91">            }</span>
<span class="nc" id="L92">          });</span>
<span class="nc" id="L93">      RocksDbHelper.printTotals(out, columnFamilyUsages);</span>
<span class="nc" id="L94">    }</span>
  }

  @Command(
      name = &quot;x-stats&quot;,
      description = &quot;Print rocksdb stats&quot;,
      mixinStandardHelpOptions = true,
      versionProvider = VersionProvider.class)
<span class="fc" id="L102">  static class RocksDbStats implements Runnable {</span>

    @SuppressWarnings(&quot;unused&quot;)
    @CommandLine.Spec
    private CommandLine.Model.CommandSpec spec;

    @SuppressWarnings(&quot;unused&quot;)
    @ParentCommand
    private RocksDbSubCommand rocksDbSubCommand;

    @Override
    public void run() {

<span class="nc" id="L115">      final PrintWriter out = spec.commandLine().getOut();</span>

<span class="nc" id="L117">      final String dbPath =</span>
          rocksDbSubCommand
              .storageSubCommand
              .besuCommand
<span class="nc" id="L121">              .dataDir()</span>
<span class="nc" id="L122">              .resolve(DATABASE_PATH)</span>
<span class="nc" id="L123">              .toString();</span>

<span class="nc" id="L125">      out.println(&quot;Column Family Stats...&quot;);</span>
<span class="nc" id="L126">      RocksDbHelper.forEachColumnFamily(</span>
          dbPath,
          (rocksdb, cfHandle) -&gt; {
            try {
<span class="nc" id="L130">              RocksDbHelper.printStatsForColumnFamily(rocksdb, cfHandle, out);</span>
<span class="nc" id="L131">            } catch (RocksDBException e) {</span>
<span class="nc" id="L132">              throw new RuntimeException(e);</span>
<span class="nc" id="L133">            }</span>
<span class="nc" id="L134">          });</span>
<span class="nc" id="L135">    }</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>